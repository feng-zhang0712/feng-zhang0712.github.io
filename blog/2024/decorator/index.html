<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> ES6 - 装饰器 | Zhang Feng </title> <meta name="author" content="Zhang Feng"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://feng-zhang0712.github.io//blog/2024/decorator/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Zhang</span> Feng </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">ES6 - 装饰器</h1> <p class="post-meta"> Created in September 12, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/react"> <i class="fa-solid fa-hashtag fa-sm"></i> React</a>   <a href="/blog/tag/es6"> <i class="fa-solid fa-hashtag fa-sm"></i> ES6</a>   <a href="/blog/tag/decorator"> <i class="fa-solid fa-hashtag fa-sm"></i> Decorator</a>   ·   <a href="/blog/category/blog"> <i class="fa-solid fa-tag fa-sm"></i> blog</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>本文是对<a href="https://es6.ruanyifeng.com/#docs/decorator" rel="external nofollow noopener" target="_blank">《ECMAScript 6 入门 - 装饰器》</a>一章中知识点的摘录，请访问原文，获取更多详细信息。</p> </blockquote> <h2 id="一简介新语法">一、简介（新语法）</h2> <p>装饰器（Decorator）用来增强 JavaScript 类（class）的功能，是一种用于修改类的行为的语法糖。装饰器是一种函数，写成 <code class="language-plaintext highlighter-rouge">@ + 函数名</code>，可以用来装饰四种类型的值。</p> <ul> <li><strong>类</strong></li> <li>类的<strong>属性</strong> </li> <li>类的<strong>方法</strong> </li> <li>属性<strong>存取器</strong>（accessor）</li> </ul> <p>目前，装饰器还未进入 ECMAScript 标准。</p> <h2 id="二装饰器-api新语法">二、装饰器 API（新语法）</h2> <p>装饰器是一个函数，API 的类型描述如下（TypeScript 写法）。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">Decorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">symbol</span><span class="p">;</span>
  <span class="nl">access</span><span class="p">:</span> <span class="p">{</span>
    <span class="kd">get</span><span class="p">?():</span> <span class="nx">unknown</span><span class="p">;</span>
    <span class="kd">set</span><span class="p">?(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="kr">private</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="kd">static</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nx">addInitializer</span><span class="p">?(</span><span class="nx">initializer</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">Output</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>
</code></pre></div></div> <p>装饰器函数有两个参数。运行时，JavaScript 引擎会提供这两个参数。装饰器函数的返回值，是一个新版本的装饰对象，但也可以不返回任何值（<code class="language-plaintext highlighter-rouge">void</code>）。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">value</code>：所要装饰的值，某些情况下可能是 <code class="language-plaintext highlighter-rouge">undefined</code>（装饰属性时）。</li> <li> <p><code class="language-plaintext highlighter-rouge">context</code>：上下文信息对象。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">kind</code>：字符串，表示装饰类型，可能的取值有 <code class="language-plaintext highlighter-rouge">class</code>、<code class="language-plaintext highlighter-rouge">field</code>、<code class="language-plaintext highlighter-rouge">method</code>、<code class="language-plaintext highlighter-rouge">setter</code>、<code class="language-plaintext highlighter-rouge">getter</code>、<code class="language-plaintext highlighter-rouge">accessor</code>。</li> <li> <code class="language-plaintext highlighter-rouge">name</code>：被装饰的值的名称：值的名称，或者在私有元素的情况下，该元素的描述（比如可读名称）。</li> <li> <code class="language-plaintext highlighter-rouge">access</code>：对象，包含访问这个值的方法，即存值器和取值器。</li> <li> <code class="language-plaintext highlighter-rouge">static</code>： 布尔值，该值是否为静态元素。</li> <li> <code class="language-plaintext highlighter-rouge">private</code>：布尔值，该值是否为私有元素。</li> <li> <code class="language-plaintext highlighter-rouge">addInitializer</code>：函数，允许用户增加初始化逻辑。</li> </ul> </li> </ul> <p>装饰器的执行步骤如下。</p> <ol> <li>计算各个装饰器的值，按照从左到右，从上到下的顺序。</li> <li>调用方法装饰器。</li> <li>调用类装饰器。</li> </ol> <h2 id="三类的装饰">三、类的装饰</h2> <p><strong>装饰器可以用来装饰整个类</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">testable</span>
<span class="kd">class</span> <span class="nc">MyTestableClass</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">testable</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">target</span><span class="p">.</span><span class="nx">isTestable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">MyTestableClass</span><span class="p">.</span><span class="nx">isTestable</span> <span class="c1">// true</span>
</code></pre></div></div> <p>上面代码中，<code class="language-plaintext highlighter-rouge">@testable</code> 就是一个装饰器。它修改了 <code class="language-plaintext highlighter-rouge">MyTestableClass</code> 这个类的行为，为它加上了静态属性 <code class="language-plaintext highlighter-rouge">isTestable</code>。<code class="language-plaintext highlighter-rouge">testable</code> 函数的参数 <code class="language-plaintext highlighter-rouge">target</code> 是 <code class="language-plaintext highlighter-rouge">MyTestableClass</code> 类本身。</p> <p>装饰器是一个对类进行处理的函数。装饰器函数的第一个参数，就是所要装饰的<strong>目标类</strong>。装饰器的行为类似于下面这样。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">decorator</span>
<span class="kd">class</span> <span class="nc">A</span> <span class="p">{}</span>

<span class="c1">// 等同于</span>
<span class="kd">class</span> <span class="nc">A</span> <span class="p">{}</span>
<span class="nx">A</span> <span class="o">=</span> <span class="nf">decorator</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span> <span class="o">||</span> <span class="nx">A</span><span class="p">;</span>
</code></pre></div></div> <p><strong>通过操作目标类的 <code class="language-plaintext highlighter-rouge">prototype</code> 对象，可以为类添加实例属性</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">testable</span>
<span class="kd">class</span> <span class="nc">MyTestableClass</span> <span class="p">{}</span>

<span class="kd">function</span> <span class="nf">testable</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">target</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isTestable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyTestableClass</span><span class="p">();</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">isTestable</span> <span class="c1">// true</span>
</code></pre></div></div> <p>实际开发中，React 与 Redux 库结合使用时。可以使用装饰器对 <code class="language-plaintext highlighter-rouge">connect</code> 方法进行改造，改造后的写法看上去更容易理解。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyReactComponent</span> <span class="kd">extends</span> <span class="nc">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{}</span>
<span class="k">export</span> <span class="k">default</span> <span class="nf">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">MyReactComponent</span><span class="p">);</span>

<span class="c1">// 改造后</span>
<span class="p">@</span><span class="nd">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nc">MyReactComponent</span> <span class="kd">extends</span> <span class="nc">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{}</span>
</code></pre></div></div> <h2 id="四类装饰器新语法">四、类装饰器（新语法）</h2> <p>类装饰器的第一个参数，是被装饰的类。第二个参数是上下文对象，如果被装饰的类是一个匿名类，<code class="language-plaintext highlighter-rouge">name</code> 属性就为 <code class="language-plaintext highlighter-rouge">undefined</code>。类装饰器的类型描述如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ClassDecorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nf">addInitializer</span><span class="p">(</span><span class="nx">initializer</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="nb">Function</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>
</code></pre></div></div> <p><strong>类装饰器可以返回一个新的类，取代原来的类，也可以不返回任何值</strong>。如果返回的不是构造函数，就会报错。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">logged</span> 
<span class="kd">class</span> <span class="nc">C</span> <span class="p">{}</span>

<span class="kd">function</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">value</span> <span class="p">{</span>
      <span class="nf">constructor</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`constructing an instance of </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with arguments </span><span class="p">${</span><span class="nx">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">, </span><span class="dl">"</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nc">C</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// constructing an instance of C with arguments 1</span>
</code></pre></div></div> <h2 id="五方法的装饰">五、方法的装饰</h2> <p><strong>装饰器可以装饰类的属性</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">readonly</span>
  <span class="nf">name</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">first</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">}</span><span class="s2">`</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">readonly</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">){</span>
  <span class="c1">// descriptor对象原来的值如下</span>
  <span class="c1">// {</span>
  <span class="c1">//   value: specifiedFunction,</span>
  <span class="c1">//   enumerable: false,</span>
  <span class="c1">//   configurable: true,</span>
  <span class="c1">//   writable: true</span>
  <span class="c1">// };</span>
  <span class="nx">descriptor</span><span class="p">.</span><span class="nx">writable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">descriptor</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">readonly</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">);</span>
<span class="c1">// 类似于</span>
<span class="nb">Object</span><span class="p">.</span><span class="nf">defineProperty</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">);</span>
</code></pre></div></div> <p>上面代码中，装饰器 <code class="language-plaintext highlighter-rouge">readonly</code> 用来装饰类的 <code class="language-plaintext highlighter-rouge">name</code> 方法。装饰器函数 <code class="language-plaintext highlighter-rouge">readonly</code> 可以接受三个参数。</p> <ul> <li>第一个参数是类的原型对象，上例是 <code class="language-plaintext highlighter-rouge">Person.prototype</code>，装饰器的本意是要“装饰”类的实例，但是这个时候实例还没生成，所以只能去装饰原型（这不同于类的装饰，那种情况时 <code class="language-plaintext highlighter-rouge">target</code> 参数指的是类本身）。</li> <li>第二个参数是所要装饰的属性名。</li> <li>第三个参数是该属性的描述对象。</li> </ul> <p><strong>装饰器可以修改属性的描述对象</strong>，然后被修改的描述对象再用来定义属性。下面的例子，修改属性描述对象的 <code class="language-plaintext highlighter-rouge">enumerable</code> 属性，使得该属性不可遍历。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">nonenumerable</span>
  <span class="kd">get</span> <span class="nf">kidCount</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">nonenumerable</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">descriptor</span><span class="p">.</span><span class="nx">enumerable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">descriptor</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>下面的 <code class="language-plaintext highlighter-rouge">@log</code> 装饰器，可以起到输出日志的作用。<code class="language-plaintext highlighter-rouge">@log</code> 装饰器的作用就是在执行原始的操作之前，执行一次 <code class="language-plaintext highlighter-rouge">console.log</code>，从而达到输出日志的目的。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Math</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">log</span>
  <span class="nf">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">log</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

  <span class="nx">descriptor</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Calling </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with`</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">oldValue</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">descriptor</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">math</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Math</span><span class="p">();</span>

<span class="c1">// passed parameters should get logged now</span>
<span class="nx">math</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</code></pre></div></div> <p><strong>装饰器有注释的作用</strong>。比如下面的代码，我们一眼就能看出，<code class="language-plaintext highlighter-rouge">Person</code> 类是可测试的，而 <code class="language-plaintext highlighter-rouge">name</code> 方法是只读和不可枚举的。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">testable</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">readonly</span>
  <span class="p">@</span><span class="nd">nonenumerable</span>
  <span class="nf">name</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">first</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">}</span><span class="s2">`</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>如果同一个方法有多个装饰器，会先从外到内进入，然后由内向外执行</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">dec</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">evaluated</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">executed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Example</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">dec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">dec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nf">method</span><span class="p">(){}</span>
<span class="p">}</span>
<span class="c1">// evaluated 1</span>
<span class="c1">// evaluated 2</span>
<span class="c1">// executed 2</span>
<span class="c1">// executed 1</span>
</code></pre></div></div> <p>上面代码中，外层装饰器 <code class="language-plaintext highlighter-rouge">@dec(1)</code> 先进入，但是内层装饰器 <code class="language-plaintext highlighter-rouge">@dec(2)</code> 先执行。</p> <p>除了注释，<strong>装饰器还能用来类型检查</strong>。所以，对于类来说，这项功能相当有用。从长期来看，它将是 JavaScript 代码静态分析的重要工具。</p> <h2 id="六方法装饰器新语法">六、方法装饰器（新语法）</h2> <p><strong>方法装饰器可以用来修改类的方法</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">trace</span>
  <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">C</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 相当于</span>
<span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="nf">trace</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">);</span>
</code></pre></div></div> <p>方法装饰器使用 TypeScript 描述类型如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ClassMethodDecorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">symbol</span><span class="p">;</span>
  <span class="nl">access</span><span class="p">:</span> <span class="p">{</span> <span class="nf">get</span><span class="p">():</span> <span class="nx">unknown</span> <span class="p">};</span>
  <span class="nl">static</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">private</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nf">addInitializer</span><span class="p">(</span><span class="nx">initializer</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="nb">Function</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>
</code></pre></div></div> <p>方法装饰器的第一个参数 <code class="language-plaintext highlighter-rouge">value</code>，就是所要装饰的方法。</p> <p><strong>方法装饰器可以返回一个新函数，取代原来的方法，也可以不返回值，表示依然使用原来的方法</strong>。如果返回其他类型的值，就会报错。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">function </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`starting </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with arguments </span><span class="p">${</span><span class="nx">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">, </span><span class="dl">"</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`ending </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">logged</span>
  <span class="nf">m</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nc">C</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// starting m with arguments 1</span>
<span class="c1">// ending m</span>
</code></pre></div></div> <p>这里的装饰器实际上是一个语法糖，真正的操作是像下面这样，改掉原型链上面 <code class="language-plaintext highlighter-rouge">m()</code> 方法。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="nf">m</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">m</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">static</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">private</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span> <span class="o">??</span> <span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
</code></pre></div></div> <h2 id="七为什么装饰器不能用于函数">七、为什么装饰器不能用于函数？</h2> <p><strong>装饰器只能用于类和类的方法，不能用于函数，因为存在函数提升</strong>。因为类不会提升，所以就没有这方面的问题。</p> <p>如果一定要装饰函数，可以采用高阶函数的形式直接执行。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello, </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">loggingDecorator</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Starting</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">wrapped</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Finished</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">wrapped</span> <span class="o">=</span> <span class="nf">loggingDecorator</span><span class="p">(</span><span class="nx">doSomething</span><span class="p">);</span>
</code></pre></div></div> <h2 id="八存取器装饰器新语法">八、存取器装饰器（新语法）</h2> <p>存取器装饰器使用 TypeScript 描述的类型如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ClassGetterDecorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">getter</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">symbol</span><span class="p">;</span>
  <span class="nl">access</span><span class="p">:</span> <span class="p">{</span> <span class="nf">get</span><span class="p">():</span> <span class="nx">unknown</span> <span class="p">};</span>
  <span class="nl">static</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">private</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nf">addInitializer</span><span class="p">(</span><span class="nx">initializer</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="nb">Function</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>

<span class="nx">type</span> <span class="nx">ClassSetterDecorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">setter</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">symbol</span><span class="p">;</span>
  <span class="nl">access</span><span class="p">:</span> <span class="p">{</span> <span class="nf">set</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="k">void</span> <span class="p">};</span>
  <span class="nl">static</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">private</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nf">addInitializer</span><span class="p">(</span><span class="nx">initializer</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="nb">Function</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>
</code></pre></div></div> <ul> <li>存取器装饰器的第一个参数是原始的存值器（setter）和取值器（getter）。</li> <li>存取器装饰器的返回值如果是一个函数，就会取代原来的存取器。本质上，就像方法装饰器一样，修改发生在类的<strong>原型对象</strong>上。它也可以不返回任何值，继续使用原来的存取器。如果返回其他类型的值，就会报错。</li> </ul> <p>上一节的 <code class="language-plaintext highlighter-rouge">@logged</code> 装饰器稍加修改，就可以用在存取装饰器。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">getter</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">setter</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">function </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`starting </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with arguments </span><span class="p">${</span><span class="nx">args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">, </span><span class="dl">"</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`ending </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">logged</span>
  <span class="kd">set</span> <span class="nf">x</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nc">C</span><span class="p">().</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">// starting x with arguments 1</span>
<span class="c1">// ending x</span>
</code></pre></div></div> <p>如果去掉语法糖，使用传统语法来写，就是改掉了类的原型链。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="kd">set</span> <span class="nf">x</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="p">{</span> <span class="kd">set</span> <span class="p">}</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">getOwnPropertyDescriptor</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">set</span> <span class="o">=</span> <span class="nf">logged</span><span class="p">(</span><span class="kd">set</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">setter</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">static</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">private</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span> <span class="o">??</span> <span class="kd">set</span><span class="p">;</span>

<span class="nb">Object</span><span class="p">.</span><span class="nf">defineProperty</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="kd">set</span> <span class="p">});</span>
</code></pre></div></div> <h2 id="九属性装饰器新语法">九、属性装饰器（新语法）</h2> <p>属性装饰器的类型描述如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">ClassFieldDecorator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">context</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">;</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">symbol</span><span class="p">;</span>
  <span class="nl">access</span><span class="p">:</span> <span class="p">{</span> <span class="nf">get</span><span class="p">():</span> <span class="nx">unknown</span><span class="p">,</span> <span class="nf">set</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="k">void</span> <span class="p">};</span>
  <span class="nl">static</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">private</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">initialValue</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">unknown</span> <span class="o">|</span> <span class="k">void</span><span class="p">;</span>
</code></pre></div></div> <ul> <li>属性装饰器的第一个参数是 <code class="language-plaintext highlighter-rouge">undefined</code>，即不输入值。</li> <li>用户可以选择让装饰器返回一个初始化函数，当该属性被赋值时，这个初始化函数会自动运行，它会收到属性的初始值，然后返回一个新的初始值。属性装饰器也可以不返回任何值。除了这两种情况，返回其他类型的值都会报错。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">function </span><span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`initializing </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with value </span><span class="p">${</span><span class="nx">initialValue</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">initialValue</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">logged</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nc">C</span><span class="p">();</span>
<span class="c1">// initializing x with value 1</span>
</code></pre></div></div> <p>如果不使用装饰器语法，属性装饰器的实际作用如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">initializeX</span> <span class="o">=</span> <span class="nf">logged</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">field</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">static</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">private</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span> <span class="o">??</span> <span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">initialValue</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="nx">initializeX</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div> <h2 id="十accessor-命令新语法">十、accessor 命令（新语法）</h2> <p><strong>类装饰器引入了一个新命令 <code class="language-plaintext highlighter-rouge">accessor</code>，用于属性的前缀。它是一种简写形式，相当于声明属性 <code class="language-plaintext highlighter-rouge">x</code> 是私有属性 <code class="language-plaintext highlighter-rouge">#x</code> 的存取接口</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="nx">accessor</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 上面的代码等同于下面的代码。</span>
<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="nx">#x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kd">get</span> <span class="nf">x</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">#x</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">set</span> <span class="nf">x</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">#x</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">accessor</code> 命令前面，可以加上 <code class="language-plaintext highlighter-rouge">static</code> 命令和 <code class="language-plaintext highlighter-rouge">private</code> 命令，也可以接受属性装饰器</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">logged</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">kind</span><span class="p">,</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">kind</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">accessor</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="p">{</span> <span class="kd">get</span><span class="p">,</span> <span class="kd">set</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`getting </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">return</span> <span class="kd">get</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">},</span>

      <span class="nf">set</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`setting </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> to </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">return</span> <span class="kd">set</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
      <span class="p">},</span>

      <span class="nf">init</span><span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`initializing </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2"> with value </span><span class="p">${</span><span class="nx">initialValue</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">initialValue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">logged</span> <span class="nx">accessor</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">C</span><span class="p">();</span>
<span class="c1">// initializing x with value 1</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="c1">// getting x</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="c1">// setting x to 123</span>
</code></pre></div></div> <p>上面的示例等同于使用 <code class="language-plaintext highlighter-rouge">@logged</code> 装饰器，改写 <code class="language-plaintext highlighter-rouge">accessor</code> 属性的 <code class="language-plaintext highlighter-rouge">getter</code> 和 <code class="language-plaintext highlighter-rouge">setter</code> 方法。</p> <h2 id="十一addinitializer-方法新语法">十一、addInitializer() 方法（新语法）</h2> <p>除了属性装饰器，其他装饰器的上下文对象还包括一个 <code class="language-plaintext highlighter-rouge">addInitializer()</code> 方法，用来完成初始化操作。它的运行时间如下。</p> <ul> <li>类装饰器：在类被完全定义之后。</li> <li>方法装饰器：在类构造期间运行，在属性初始化之前。</li> <li>静态方法装饰器：在类定义期间运行，早于静态属性定义，但晚于类方法的定义。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">customElement</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="p">{</span> <span class="nx">addInitializer</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">addInitializer</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">customElements</span><span class="p">.</span><span class="nf">define</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">customElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-element</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">MyElement</span> <span class="kd">extends</span> <span class="nc">HTMLElement</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">get</span> <span class="nf">observedAttributes</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">'</span><span class="s1">some</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">attrs</span><span class="dl">'</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>上面的代码等同于下面不使用装饰器的代码。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyElement</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">get</span> <span class="nf">observedAttributes</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">'</span><span class="s1">some</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">attrs</span><span class="dl">'</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">initializersForMyElement</span> <span class="o">=</span> <span class="p">[];</span>

<span class="nx">MyElement</span> <span class="o">=</span> <span class="nf">customElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-element</span><span class="dl">'</span><span class="p">)(</span><span class="nx">MyElement</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">kind</span><span class="p">:</span> <span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">MyElement</span><span class="dl">"</span><span class="p">,</span>
  <span class="nf">addInitializer</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">initializersForMyElement</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">})</span> <span class="o">??</span> <span class="nx">MyElement</span><span class="p">;</span>

<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">initializer</span> <span class="k">of</span> <span class="nx">initializersForMyElement</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">initializer</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">MyElement</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="十二core-decoratorsjs">十二、core-decorators.js</h2> <p><a href="https://github.com/jayphelps/core-decorators.js" rel="external nofollow noopener" target="_blank">core-decorators.js</a> 是一个第三方模块，提供了几个常见的装饰器，通过它可以更好地理解装饰器。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">@autobind</code> 装饰器使得方法中的 <code class="language-plaintext highlighter-rouge">this</code> 对象，绑定原始对象。</li> <li> <code class="language-plaintext highlighter-rouge">@readonly</code> 装饰器使得属性或方法不可写。</li> <li> <code class="language-plaintext highlighter-rouge">@override</code> 装饰器检查子类的方法，是否正确覆盖了父类的同名方法，如果不正确会报错。</li> <li> <code class="language-plaintext highlighter-rouge">@deprecate</code> 或 <code class="language-plaintext highlighter-rouge">@deprecated</code> 装饰器在控制台显示一条警告，表示该方法将废除。</li> <li> <code class="language-plaintext highlighter-rouge">@suppressWarnings</code> 装饰器抑制 <code class="language-plaintext highlighter-rouge">@deprecated</code> 装饰器导致的 <code class="language-plaintext highlighter-rouge">console.warn()</code> 调用。但是，异步代码发出的调用除外。</li> </ul> <p>下面是一个使用 <code class="language-plaintext highlighter-rouge">@autobind</code> 的例子。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">autobind</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">core-decorators</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">autobind</span>
  <span class="nf">getPerson</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">getPerson</span> <span class="o">=</span> <span class="nx">person</span><span class="p">.</span><span class="nx">getPerson</span><span class="p">;</span>

<span class="nf">getPerson</span><span class="p">()</span> <span class="o">===</span> <span class="nx">person</span><span class="p">;</span>
<span class="c1">// true</span>
</code></pre></div></div> <h2 id="十三使用装饰器实现自动发布事件">十三、使用装饰器实现自动发布事件</h2> <p>我们可以使用装饰器，使得对象的方法被调用时，自动发出一个事件。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">postal</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">postal/lib/postal.lodash</span><span class="dl">"</span><span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">publish</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">channelName</span> <span class="o">=</span> <span class="nx">channel</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">msgChannel</span> <span class="o">=</span> <span class="nx">postal</span><span class="p">.</span><span class="nf">channel</span><span class="p">(</span><span class="nx">channelName</span><span class="p">);</span>
  <span class="nx">msgChannel</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">频道: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">channelName</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">事件: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">topic</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">数据: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

    <span class="nx">descriptor</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="nx">msgChannel</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>上面代码定义了一个名为 <code class="language-plaintext highlighter-rouge">publish</code> 的装饰器，它通过改写 <code class="language-plaintext highlighter-rouge">descriptor.value</code>，使得原方法被调用时，会自动发出一个事件。它使用的事件“发布/订阅”库是 <code class="language-plaintext highlighter-rouge">Postal.js</code>。它的用法如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js</span>
<span class="k">import</span> <span class="nx">publish</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./publish</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">FooComponent</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">publish</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo.some.message</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">component</span><span class="dl">'</span><span class="p">)</span>
  <span class="nf">someMethod</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="na">my</span><span class="p">:</span> <span class="dl">'</span><span class="s1">data</span><span class="dl">'</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="p">@</span><span class="nd">publish</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo.some.other</span><span class="dl">'</span><span class="p">)</span>
  <span class="nf">anotherMethod</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FooComponent</span><span class="p">();</span>

<span class="nx">foo</span><span class="p">.</span><span class="nf">someMethod</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">.</span><span class="nf">anotherMethod</span><span class="p">();</span>
</code></pre></div></div> <p>以后，只要调用 <code class="language-plaintext highlighter-rouge">someMethod</code> 或者 <code class="language-plaintext highlighter-rouge">anotherMethod</code>，就会自动发出一个事件。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bash-node index.js
频道:  component
事件:  foo.some.message
数据:  <span class="o">{</span> my: <span class="s1">'data'</span> <span class="o">}</span>

频道:  /
事件:  foo.some.other
数据:  undefined
</code></pre></div></div> <h2 id="十四mixin">十四、Mixin</h2> <p><strong>在装饰器的基础上，可以实现 <code class="language-plaintext highlighter-rouge">Mixin</code> 模式</strong>。所谓 <code class="language-plaintext highlighter-rouge">Mixin</code> 模式，就是对象继承的一种替代方案，中文译为“<strong>混入</strong>”（mix in），意为<strong>在一个对象中混入另外一个对象的方法</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
<span class="p">};</span>

<span class="kd">class</span> <span class="nc">MyClass</span> <span class="p">{}</span>
<span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Foo</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClass</span><span class="p">();</span>
<span class="nx">obj</span><span class="p">.</span><span class="nf">foo</span><span class="p">()</span> <span class="c1">// 'foo'</span>
</code></pre></div></div> <p>上面代码中，对象 <code class="language-plaintext highlighter-rouge">Foo</code> 有个 <code class="language-plaintext highlighter-rouge">foo</code> 方法，通过 <code class="language-plaintext highlighter-rouge">Object.assign</code> 方法，可以将 <code class="language-plaintext highlighter-rouge">foo</code> 方法“混入” <code class="language-plaintext highlighter-rouge">MyClass</code> 类，导致 <code class="language-plaintext highlighter-rouge">MyClass</code> 的实例 <code class="language-plaintext highlighter-rouge">obj</code> 对象都具有 <code class="language-plaintext highlighter-rouge">foo</code> 方法。这就是“混入”模式的一个简单实现。</p> <p>下面，我们部署一个通用脚本 <code class="language-plaintext highlighter-rouge">mixins.js</code>，将 <code class="language-plaintext highlighter-rouge">Mixin</code> 写成一个装饰器。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nf">mixins</span><span class="p">(...</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">function </span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">...</span><span class="nx">list</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">mixins</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./mixins.js</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
<span class="p">};</span>

<span class="p">@</span><span class="nd">mixins</span><span class="p">(</span><span class="nx">Foo</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">MyClass</span> <span class="p">{}</span>

<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClass</span><span class="p">();</span>
<span class="nx">obj</span><span class="p">.</span><span class="nf">foo</span><span class="p">()</span> <span class="c1">// "foo"</span>
</code></pre></div></div> <p>通过 <code class="language-plaintext highlighter-rouge">mixins</code> 这个装饰器，实现了在 <code class="language-plaintext highlighter-rouge">MyClass</code> 类上面“混入” <code class="language-plaintext highlighter-rouge">Foo</code> 对象的 <code class="language-plaintext highlighter-rouge">foo</code> 方法。上面的方法会改写 <code class="language-plaintext highlighter-rouge">MyClass</code> 类的 <code class="language-plaintext highlighter-rouge">prototype</code> 对象，如果不喜欢这一点，也可以通过类的继承实现 <code class="language-plaintext highlighter-rouge">Mixin</code>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyClass</span> <span class="kd">extends</span> <span class="nc">MyBaseClass</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div></div> <p>上面代码中，<code class="language-plaintext highlighter-rouge">MyClass</code> 继承了 <code class="language-plaintext highlighter-rouge">MyBaseClass</code>。如果我们想在 <code class="language-plaintext highlighter-rouge">MyClass</code> 里面“混入”一个 <code class="language-plaintext highlighter-rouge">foo</code> 方法，一个办法是在 <code class="language-plaintext highlighter-rouge">MyClass</code> 和 <code class="language-plaintext highlighter-rouge">MyBaseClass</code> 之间插入一个混入类，这个类具有 <code class="language-plaintext highlighter-rouge">foo</code> 方法，并且继承了 <code class="language-plaintext highlighter-rouge">MyBaseClass</code> 的所有方法，然后 <code class="language-plaintext highlighter-rouge">MyClass</code> 再继承这个类。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">MyMixin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">superclass</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">superclass</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo from MyMixin</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">class</span> <span class="nc">MyClass</span> <span class="kd">extends</span> <span class="nc">MyMixin</span><span class="p">(</span><span class="nx">MyBaseClass</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClass</span><span class="p">();</span>
<span class="nx">c</span><span class="p">.</span><span class="nf">foo</span><span class="p">();</span> <span class="c1">// "foo from MyMixin"</span>
</code></pre></div></div> <p>上面代码中，<code class="language-plaintext highlighter-rouge">MyMixin</code> 是一个混入类生成器，接受 <code class="language-plaintext highlighter-rouge">superclass</code> 作为参数，然后返回一个继承 <code class="language-plaintext highlighter-rouge">superclass</code> 的子类，该子类包含一个 <code class="language-plaintext highlighter-rouge">foo</code> 方法。目标类继承了这个混入类，就达到了“混入” <code class="language-plaintext highlighter-rouge">foo</code> 方法的目的。</p> <p>如果需要“混入”多个方法，就生成多个混入类。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyClass</span> <span class="kd">extends</span> <span class="nc">Mixin1</span><span class="p">(</span><span class="nc">Mixin2</span><span class="p">(</span><span class="nx">MyBaseClass</span><span class="p">))</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>这种写法的一个好处，是可以调用 <code class="language-plaintext highlighter-rouge">super</code>，因此可以避免在“混入”过程中覆盖父类的同名方法</strong>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">Mixin1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">superclass</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">superclass</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo from Mixin1</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="k">super</span><span class="p">.</span><span class="nx">foo</span><span class="p">)</span> <span class="k">super</span><span class="p">.</span><span class="nf">foo</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">Mixin2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">superclass</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kd">class</span> <span class="nc">extends</span> <span class="nx">superclass</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo from Mixin2</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if </span><span class="p">(</span><span class="k">super</span><span class="p">.</span><span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">super</span><span class="p">.</span><span class="nf">foo</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">class</span> <span class="nc">S</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo from S</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">C</span> <span class="kd">extends</span> <span class="nc">Mixin1</span><span class="p">(</span><span class="nc">Mixin2</span><span class="p">(</span><span class="nx">S</span><span class="p">))</span> <span class="p">{</span>
  <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo from C</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">foo</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>上面代码中，每次混入发生时，都调用了父类的 <code class="language-plaintext highlighter-rouge">super.foo</code> 方法，导致父类的同名方法没有被覆盖，行为被保留了下来。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">C</span><span class="p">().</span><span class="nf">foo</span><span class="p">()</span>
<span class="c1">// foo from C</span>
<span class="c1">// foo from Mixin1</span>
<span class="c1">// foo from Mixin2</span>
<span class="c1">// foo from S</span>
</code></pre></div></div> <h2 id="十五trait">十五、Trait</h2> <p><code class="language-plaintext highlighter-rouge">Trait</code> 也是一种装饰器，效果与 <code class="language-plaintext highlighter-rouge">Mixin</code> 类似，但是提供更多功能，比如防止同名方法的冲突、排除混入某些方法、为混入的方法起别名等等。关于这部分的详细信息，请参考<a href="https://es6.ruanyifeng.com/#docs/decorator#Trait" rel="external nofollow noopener" target="_blank">原文</a>。</p> <h2 id="十六参考">十六、参考</h2> <ul> <li>阮一峰，<a href="https://es6.ruanyifeng.com/#docs/decorator" rel="external nofollow noopener" target="_blank">ECMAScript 6 入门 - 装饰器</a> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/geolocation/">《Web API 教程 - Geolocation API》摘录</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/number/">ES6 - 数值的扩展</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/canvas/">《Web API 教程 - Canvas API》摘录</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/88-merge-sorted-array/">88. 合并两个有序数组</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/bom/">《JavaScript 教程 - 浏览器模型》摘录</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Zhang Feng. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-repositories",title:"repositories",description:"Edit the `_data/repositories.yml` and change the `github_users` and `github_repos` lists to include your own GitHub profile and repositories.",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-cv",title:"cv",description:"This is a description of the page. You can modify it in &#39;_pages/cv.md&#39;. You can also change or remove the top pdf download button.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-people",title:"people",description:"members of the lab or group",section:"Navigation",handler:()=>{window.location.href="/people/"}},{id:"dropdown-blog",title:"blog",description:"",section:"Dropdown",handler:()=>{window.location.href="/blog/"}},{id:"post-web-api-\u6559\u7a0b-geolocation-api-\u6458\u5f55",title:"\u300aWeb API \u6559\u7a0b - Geolocation API\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/geolocation/"}},{id:"post-es6-\u6570\u503c\u7684\u6269\u5c55",title:"ES6 - \u6570\u503c\u7684\u6269\u5c55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/number/"}},{id:"post-web-api-\u6559\u7a0b-canvas-api-\u6458\u5f55",title:"\u300aWeb API \u6559\u7a0b - Canvas API\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/canvas/"}},{id:"post-88-\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u6570\u7ec4",title:"88. \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u6570\u7ec4",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/88-merge-sorted-array/"}},{id:"post-javascript-\u6559\u7a0b-\u6d4f\u89c8\u5668\u6a21\u578b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b - \u6d4f\u89c8\u5668\u6a21\u578b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/bom/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/events/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/dom/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/async/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/oop/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/stdlib/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/features/"}},{id:"post-javascript-\u6559\u7a0b-\u6458\u5f55",title:"\u300aJavaScript \u6559\u7a0b\u300b\u6458\u5f55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/operators/"}},{id:"post-webpack-\u7684\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f",title:"webpack \u7684\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/publish-subscribe-model/"}},{id:"post-webpack-\u9879\u76ee\u4f18\u5316",title:"webpack \u9879\u76ee\u4f18\u5316",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/optimization/"}},{id:"post-webpack-\u5e38\u7528\u914d\u7f6e\u9879",title:"webpack \u5e38\u7528\u914d\u7f6e\u9879",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/configuration/"}},{id:"post-webpack-\u5e38\u7528\u914d\u7f6e\u9879",title:"webpack \u5e38\u7528\u914d\u7f6e\u9879",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/concepts/"}},{id:"post-webpack-\u6784\u5efa\u6d41\u7a0b",title:"webpack \u6784\u5efa\u6d41\u7a0b",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/build-flow/"}},{id:"post-webpack-\u4e2d\u7684-plugin",title:"webpack \u4e2d\u7684 Plugin",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/plugin/"}},{id:"post-webpack-\u4e2d\u7684-loader",title:"webpack \u4e2d\u7684 Loader",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/loader/"}},{id:"post-http-\u7f13\u5b58",title:"HTTP \u7f13\u5b58",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/07-caching/"}},{id:"post-http-\u8fde\u63a5\u7ba1\u7406",title:"HTTP \u8fde\u63a5\u7ba1\u7406",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/04-connection-management/"}},{id:"post-es6-\u7f16\u7a0b\u98ce\u683c",title:"ES6 - \u7f16\u7a0b\u98ce\u683c",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/style/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u5e94\u7528\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u5e94\u7528\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/application-layer/"}},{id:"post-\u54cd\u5e94\u5f0f-web-\u8bbe\u8ba1",title:"\u54cd\u5e94\u5f0f Web \u8bbe\u8ba1",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/responsive-web-design/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u8fd0\u8f93\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u8fd0\u8f93\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/transport-layer/"}},{id:"post-react-\u4e2d\u7684\u4e8b\u4ef6",title:"React \u4e2d\u7684\u4e8b\u4ef6",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/events-in-react/"}},{id:"post-css-\u9884\u5904\u7406\u5668",title:"CSS \u9884\u5904\u7406\u5668",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/css-preprocessor/"}},{id:"post-css-modules-\u7528\u6cd5\u6559\u7a0b",title:"CSS Modules \u7528\u6cd5\u6559\u7a0b",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/css-modules/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u7f51\u7edc\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u7f51\u7edc\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/network-layer/"}},{id:"post-\u8de8\u57df\u8d44\u6e90\u5171\u4eab-cors",title:"\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff08CORS\uff09",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cors/"}},{id:"post-\u9632\u6296\u548c\u8282\u6d41",title:"\u9632\u6296\u548c\u8282\u6d41",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/debounce-and-throttle/"}},{id:"post-es6-symbol",title:"ES6 - Symbol",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/symbol/"}},{id:"post-es6-\u5b57\u7b26\u4e32\u7684\u6269\u5c55",title:"ES6 - \u5b57\u7b26\u4e32\u7684\u6269\u5c55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/string/"}},{id:"post-es6-set-\u548c-map-\u6570\u636e\u7ed3\u6784",title:"ES6 - Set \u548c Map \u6570\u636e\u7ed3\u6784",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/set-map/"}},{id:"post-es6-reflect",title:"ES6 - Reflect",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/reflect/"}},{id:"post-es6-proxy",title:"ES6 - Proxy",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/proxy/"}},{id:"post-es6-promise-\u5bf9\u8c61",title:"ES6 - Promise \u5bf9\u8c61",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/promise/"}},{id:"post-es6-object",title:"ES6 - Object",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/object/"}},{id:"post-es6-\u6a21\u5757",title:"ES6 - \u6a21\u5757",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/module/"}},{id:"post-es6-let-\u548c-const-\u547d\u4ee4",title:"ES6 - let \u548c const \u547d\u4ee4",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/let-const/"}},{id:"post-es6-iterator",title:"ES6 - Iterator",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/iterator/"}},{id:"post-es6-generator-\u51fd\u6570",title:"ES6 - Generator \u51fd\u6570",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/generator/"}},{id:"post-es6-function",title:"ES6 - Function",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/function/"}},{id:"post-es6-\u88c5\u9970\u5668",title:"ES6 - \u88c5\u9970\u5668",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/decorator/"}},{id:"post-es6-class",title:"ES6 - Class",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/class/"}},{id:"post-es6-async-\u51fd\u6570",title:"ES6 - async \u51fd\u6570",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/async/"}},{id:"post-es6-array",title:"ES6 - Array",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/array/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u6570\u636e\u94fe\u8def\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u6570\u636e\u94fe\u8def\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/data-link-layer/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u7269\u7406\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u7269\u7406\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/physical-layer/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u6982\u8ff0",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u6982\u8ff0",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/instruction/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%7A%66%65%6E%67%30%37%31%32@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=qc6CJjYAAAAJ","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>