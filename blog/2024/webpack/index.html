<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Webpack | Zhang Feng </title> <meta name="author" content="Zhang Feng"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://feng-zhang0712.github.io//blog/2024/webpack/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Zhang</span> Feng </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Webpack</h1> <p class="post-meta"> Created in October 06, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/frontend"> <i class="fa-solid fa-hashtag fa-sm"></i> frontend</a>   <a href="/blog/tag/webpack"> <i class="fa-solid fa-hashtag fa-sm"></i> webpack</a>   ·   <a href="/blog/category/blog"> <i class="fa-solid fa-tag fa-sm"></i> blog</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="一概述">一、概述</h2> <p>webpack 是一个静态模块（比如各种资源文件）打包工具。webpack 会从一个或多个入口点构建依赖图(dependency graph)，然后将项目中所需的每个模块组合成一个或多个 bundles。</p> <h3 id="11-module">1.1 Module</h3> <p>Module（模块） 是 webpack 构建系统的基本单位。在 webpack 中，几乎所有的文件都被视为模块，包括 JavaScript、CSS、HTML、图片、字体等。模块是代码的最小单元，通过导入和导出实现代码的复用和分离。</p> <p>模块封装了特定功能，独立于其他模块。模块之间可以相互依赖，通过 <code class="language-plaintext highlighter-rouge">import</code> 或 <code class="language-plaintext highlighter-rouge">require</code> 引入其他模块。不仅限于 JavaScript 文件，任何资源文件都可以作为模块。</p> <h3 id="12-chunk">1.2 Chunk</h3> <p>Chunk（代码块） 是 webpack 在打包过程中生成的中间产物。每个 Chunk 包含一组紧密相关的模块。最终，一个或多个 Chunk 会被合并成一个 Bundle。</p> <p>Chunk 是 webpack 在打包过程中动态生成的。它使得代码拆分成为可能，可以根据不同的策略（如按需加载）生成多个 Chunk。Chunk 可以通过懒加载或动态导入的方式按需加载，以优化应用的加载性能。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/index.js</span>
<span class="k">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: "moduleA" */</span> <span class="dl">'</span><span class="s1">./moduleA</span><span class="dl">'</span><span class="p">).</span><span class="nf">then</span><span class="p">(({</span> <span class="nx">greeting</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">greeting</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="13-bundle">1.3 Bundle</h3> <p>Bundle（包） 是 webpack 打包后的输出文件，它包含了应用程序的所有模块代码。Bundle 是浏览器可以执行的最终文件，通常是一个或多个 JavaScript 文件。</p> <p>Bundle 是 webpack 打包的最终结果。在小型项目中，所有模块可能会被打包成一个单一的 Bundle 文件。在大型项目中，可以使用代码拆分（code splitting）将模块打包成多个 Bundle 文件，以优化加载性能。</p> <h3 id="14-webpack-中的占位符">1.4 webpack 中的占位符</h3> <ol> <li> <strong><code class="language-plaintext highlighter-rouge">[name]</code></strong>：表示模块的名称。通常用于多入口配置中，根据入口名称生成文件名。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[id]</code></strong>：表示模块的 ID。用于生成文件名中的模块 ID，适用于需要唯一标识模块的场景。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[hash]</code></strong>：表示编译时的哈希值。常用于生成具有唯一性的文件名，防止缓存问题。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[chunkhash]</code></strong>：表示代码块的哈希值。用于根据代码块内容生成哈希值，适用于代码分割和缓存优化。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[contenthash]</code></strong>：表示文件内容的哈希值。适用于根据文件内容生成哈希值，通常用于生成 CSS 文件名。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[ext]</code></strong>：表示文件的扩展名。用于保持文件的原始扩展名，适用于文件处理和加载。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[path]</code></strong>：表示包含文件的路径。用于生成包含文件路径的文件名，适用于文件管理和组织。</li> <li> <strong><code class="language-plaintext highlighter-rouge">[query]</code></strong>：表示文件请求中的查询字符串。用于生成包含查询字符串的文件名，适用于动态加载和参数传递。</li> </ol> <h2 id="二webpack-常用配置项">二、webpack 常用配置项</h2> <h3 id="21-entry">2.1 Entry</h3> <p><code class="language-plaintext highlighter-rouge">entry</code> 指定 webpack 构建的入口。webpack 会从入口文件开始构建依赖图。在书写形式上，分为单入口、多入口和数组入口。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 单入口文件写法</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// 多个入口文件写法，它们将分别生成各自的打包文件</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">app</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/app.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">admin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/admin.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// 数组入口文件写法，表示多个入口文件将被打包到一个文件中</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./src/index.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">./src/vendor.js</span><span class="dl">'</span><span class="p">],</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="22-output">2.2 Output</h3> <p><code class="language-plaintext highlighter-rouge">output</code> 指定打包文件的输出位置和文件名。</p> <h3 id="23-module">2.3 Module</h3> <p><code class="language-plaintext highlighter-rouge">module</code> 定义处理不同类型文件模块的规则。即如何处理除 <code class="language-plaintext highlighter-rouge">.js</code> 文件以外的其他资源，例如 CSS、图片、字体等。<code class="language-plaintext highlighter-rouge">module</code> 配置项主要包含 <code class="language-plaintext highlighter-rouge">rules</code> 和 <code class="language-plaintext highlighter-rouge">noParse</code> 两个属性。</p> <h4 id="1-modulerules">(1) <code class="language-plaintext highlighter-rouge">module.rules</code> </h4> <p><code class="language-plaintext highlighter-rouge">module.rules</code> 属性是 <code class="language-plaintext highlighter-rouge">module</code> 配置项的核心部分，它是一个数组，每个元素都是一个规则对象，用于定义如何使用 Loader 加载和转换不同类型的模块。<code class="language-plaintext highlighter-rouge">module.rules</code> 对象的主要属性如下。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">test</code>：一个正则表达式，用于匹配文件路径。</li> <li> <code class="language-plaintext highlighter-rouge">exclude</code>：排除的文件路径，通常用于排除 <code class="language-plaintext highlighter-rouge">node_modules</code> 目录。</li> <li> <code class="language-plaintext highlighter-rouge">include</code>：包含的文件路径，通常用于指定处理哪些目录下的文件。</li> <li> <code class="language-plaintext highlighter-rouge">use</code>：指定使用的加载器（详细方式），可以是单个加载器或加载器数组。</li> <li> <code class="language-plaintext highlighter-rouge">loader</code>：指定使用的加载器（简写方式）。</li> <li> <code class="language-plaintext highlighter-rouge">options</code>：加载器的选项参数。</li> <li> <code class="language-plaintext highlighter-rouge">type</code>：指定模块的类型，例如 <code class="language-plaintext highlighter-rouge">json</code> 等。</li> </ul> <p>以下是一个 <code class="language-plaintext highlighter-rouge">module.rules</code> 配置项的例子。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpg|gif</span><span class="se">)</span><span class="sr">$/</span><span class="p">,</span> <span class="c1">// 匹配图片文件</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">file-loader</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[name].[hash].[ext]</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 保持文件名和扩展名</span>
              <span class="na">outputPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">images/</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 输出路径</span>
            <span class="p">},</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.(</span><span class="sr">woff|woff2|eot|ttf|otf</span><span class="se">)</span><span class="sr">$/</span><span class="p">,</span> <span class="c1">// 匹配字体文件</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">file-loader</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[name].[hash].[ext]</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 保持文件名和扩展名</span>
              <span class="na">outputPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">fonts/</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 输出路径</span>
            <span class="p">},</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <p>Loader 本质上是一个函数，主要用于在 webpack 构建过程中，将不同类型的文件转换为模块。Loader 可以处理 JavaScript 以外的资源文件，例如 CSS、SCSS、TypeScript、图片等。它们允许你在 <code class="language-plaintext highlighter-rouge">import</code> 或 <code class="language-plaintext highlighter-rouge">require</code> 模块时预处理文件。以下是一些 webpack 中常见的 Loader。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">babel-loader</code>：用于将最新的 ES 语法转换为浏览器是别的 JavaScript。</li> <li> <code class="language-plaintext highlighter-rouge">style-loader</code>：将 css 添加到样式标签 <code class="language-plaintext highlighter-rouge">style</code> 中。</li> <li> <code class="language-plaintext highlighter-rouge">css-loader</code>：允许将 css 文件通过 require 的方式引入，并返回 css 代码。</li> <li> <code class="language-plaintext highlighter-rouge">sass-loader:</code>：处理 sass 文件。</li> <li> <code class="language-plaintext highlighter-rouge">postcss-loader</code>：用 postcss 来处理 CSS。</li> <li> <code class="language-plaintext highlighter-rouge">file-loader</code>：分发文件到 output 目录并返回相对路径。</li> <li> <code class="language-plaintext highlighter-rouge">url-loader</code>：和 <code class="language-plaintext highlighter-rouge">file-loader</code> 类似，可以选择性的把图片转成 base64 格式的字符串，并打包到 js 中，比较合适对小图片的处理。</li> <li> <code class="language-plaintext highlighter-rouge">html-minify-loader</code>：压缩 HTML。</li> </ul> <p>注意，大部分 Loader 在使用之前要先下载。</p> <h4 id="2modulenoparse">（2）<code class="language-plaintext highlighter-rouge">module.noParse</code> </h4> <p><code class="language-plaintext highlighter-rouge">module.noParse</code> 用于配置哪些模块文件不需要解析。通过 <code class="language-plaintext highlighter-rouge">noParse</code>，可以跳过对大型库或文件的解析。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">noParse</span><span class="p">:</span> <span class="sr">/jquery|lodash/</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <p>上面的代码，告诉 webpack 在进行代码解析式，不解析 <code class="language-plaintext highlighter-rouge">jquery</code> 和 <code class="language-plaintext highlighter-rouge">lodash</code> 库。</p> <h3 id="24-plugins">2.4 Plugins</h3> <p>Plugin 用于扩展 webpack 的功能。它们可以在整个编译生命周期的不同阶段执行更广泛的任务，如 <strong>打包优化</strong>、<strong>环境变量注入</strong>、<strong>代码压缩</strong> 等。Plugin 可以比 Loader 处理更加复杂和多样化的任务。</p> <p>Plugin 是具有 <code class="language-plaintext highlighter-rouge">apply</code> 方法的 JavaScript 对象。这个 <code class="language-plaintext highlighter-rouge">apply</code> 方法在 webpack 启动时被调用，并且插件可以通过 webpack 的钩子机制（hooks）在编译过程的各个阶段插入自己的逻辑。</p> <p>以下是一些 webpack 中常见的 Plugin。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">DefinePlugin</code>：允许在编译时创建配置的全局对象，它是一个 webpack 内置的插件，不需要安装。</li> <li> <code class="language-plaintext highlighter-rouge">html-webpack-plugin</code>：用于简化 HTML 文件的创建、管理以及注入打包后的 JavaScript 文件。</li> <li> <code class="language-plaintext highlighter-rouge">mini-css-extract-plugin</code>：将 CSS 从 JavaScript 中提取出来，生成独立的 CSS 文件。</li> <li><code class="language-plaintext highlighter-rouge">css-minimizer-webpack-plugin</code></li> <li><code class="language-plaintext highlighter-rouge">terser-webpack-plugin</code></li> </ul> <h3 id="25-mode">2.5 Mode</h3> <p><code class="language-plaintext highlighter-rouge">mode</code> 用于设置构建模式，影响 webpack 内置的优化功能。webpack 提供了三种模式。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">development</code>：用于开发环境。在这个模式下， 主要侧重于提升构建速度和开发体验。在此模式下， webpack 不会压缩代码，并且会启用 Source Map、HMR（热模块替换）和详细的日志。</li> <li> <code class="language-plaintext highlighter-rouge">production</code>：用于生产环境。在这个模式下， 主要侧重于优化代码体积和运行性能。在此模式下， webpack 会启用代码压缩和混淆、自动移除未使用的代码（Tree Shaking）和启用各种优化（如代码拆分、作用域提升）等。</li> <li> <code class="language-plaintext highlighter-rouge">none</code>：不应用任何默认优化或配置。在这个模式下，只会按照配置文件中的指示进行打包，而不进行额外的优化和处理。</li> </ul> <h3 id="26-resolve">2.6 Resolve</h3> <p><code class="language-plaintext highlighter-rouge">resolve</code> 控制模块解析的行为。包括定义模块路径的查找方式、文件扩展名的解析顺序、别名等。<code class="language-plaintext highlighter-rouge">resolve</code> 的主要配置项如下。</p> <h4 id="1resolvealias">（1）<code class="language-plaintext highlighter-rouge">resolve.alias</code> </h4> <p><code class="language-plaintext highlighter-rouge">resolve.alias</code> 用于为模块路径创建别名。通过别名，可以简化模块引用的路径。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">alias</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">@components</span><span class="dl">'</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src/components/</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="k">import</span> <span class="nx">Button</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@components/Button</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div> <p>上面的代码中，我们为 <code class="language-plaintext highlighter-rouge">src/components/</code> 目录指定了一个别名 <code class="language-plaintext highlighter-rouge">@components</code>，这样在导入模块时，就可以使用 <code class="language-plaintext highlighter-rouge">import xxx from '@components/xxx'</code> 的形式，而不必每次都写前边的路径。</p> <h4 id="2resolveextensions">（2）<code class="language-plaintext highlighter-rouge">resolve.extensions</code> </h4> <p><code class="language-plaintext highlighter-rouge">resolve.extensions</code> 定义在解析模块时可以省略的文件扩展名。默认值是 <code class="language-plaintext highlighter-rouge">['.js', '.json']</code>。</p> <h4 id="3resolvemodules">（3）<code class="language-plaintext highlighter-rouge">resolve.modules</code> </h4> <p><code class="language-plaintext highlighter-rouge">resolve.modules</code> 指定解析模块时要搜索的目录。默认值是 [‘node_modules’]。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">modules</span><span class="p">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">),</span> <span class="dl">'</span><span class="s1">node_modules</span><span class="dl">'</span><span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="k">import</span> <span class="nx">Util</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">utils/util</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 实际引入的是 'src/utils/util.js'</span>
</code></pre></div></div> <p>上面的代码，我们指定了 <code class="language-plaintext highlighter-rouge">resolve.modules</code> 的目录为 <code class="language-plaintext highlighter-rouge">src</code> 和 <code class="language-plaintext highlighter-rouge">node_modules</code>。这样，在导入模块时，webpack 会首先去 <code class="language-plaintext highlighter-rouge">src</code> 目录下寻找，如果找不到，就去 <code class="language-plaintext highlighter-rouge">node_modules</code> 目录下寻找。</p> <h4 id="4resolvefallback">（4）<code class="language-plaintext highlighter-rouge">resolve.fallback</code> </h4> <p><code class="language-plaintext highlighter-rouge">resolve.fallback</code> 指定当模块在指定目录中找不到时，应该回退到哪个目录进行查找。常用于处理某些模块在特定环境下的缺失问题。</p> <h4 id="5resolveplugins">（5）<code class="language-plaintext highlighter-rouge">resolve.plugins</code> </h4> <p><code class="language-plaintext highlighter-rouge">resolve.plugins</code> 用于配置一些自定义的解析插件。可以定义自己的解析规则或使用现成的解析插件。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">alias</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">@components</span><span class="dl">'</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src/components/</span><span class="dl">'</span><span class="p">),</span>
      <span class="dl">'</span><span class="s1">@utils</span><span class="dl">'</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src/utils/</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.jsx</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.json</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.ts</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.tsx</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">modules</span><span class="p">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">),</span> <span class="dl">'</span><span class="s1">node_modules</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">fallback</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">:</span> <span class="nx">require</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">path-browserify</span><span class="dl">'</span><span class="p">),</span>
      <span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">:</span> <span class="nx">require</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto-browserify</span><span class="dl">'</span><span class="p">),</span>
    <span class="p">},</span>
     <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
      <span class="c1">// 在此添加解析插件</span>
    <span class="p">],</span>

    <span class="c1">// 其他配置...</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="27-devtool">2.7 Devtool</h3> <p><code class="language-plaintext highlighter-rouge">devtool</code> 用于控制生成 source map 的方式。source map 用于将编译后的代码映射回源代码，有助于调试和错误追踪。常见的 <code class="language-plaintext highlighter-rouge">devtool</code> 配置有如下几个。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">cheap-module-source-map</code></strong>：类似于 cheap-source-map，对 loader 处理后的代码也生成 source map。优点是构建速度较快，适合调试经过 loader 处理的代码。缺点是调试时无法准确定位到列，适合开发环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">source-map</code></strong>：生成独立的 <code class="language-plaintext highlighter-rouge">.map</code> 文件，提供完整的 source map。优点是可以查看源文件及其位置。缺点是构建速度慢，适合生产环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">eval</code></strong>：使用 <code class="language-plaintext highlighter-rouge">eval</code> 生成每个模块的 source map。优点是构建速度最快，缺点是生成的 source map 不支持断点调试，适合快速开发和调试。</li> <li> <strong><code class="language-plaintext highlighter-rouge">inline-source-map</code></strong>：将 source map 作为 Data URL 内嵌在编译后的代码中。优点是调试体验好，构建速度较快。缺点是会增加文件体积，适合开发环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">cheap-source-map</code></strong>：生成独立的 source map 文件，但不包含列信息。优点是构建速度较快，适合开发环境。缺点是调试时无法准确定位到列，适合开发环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">eval-source-map</code></strong>：每个模块使用 eval 生成 source map，并将 source map 作为 Data URL 内嵌。优点是构建速度快，调试体验好。适合开发环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">hidden-source-map</code></strong>：生成独立的 source map 文件，但不在编译后的代码中引用。优点是保护源代码，但仍然可以使用 source map 进行调试。缺点是需要手动关联 source map 文件，适合生产环境。</li> <li> <strong><code class="language-plaintext highlighter-rouge">nosources-source-map</code></strong>：生成独立的 source map 文件，但隐藏源文件内容。优点是保护源代码内容，但提供错误信息的映射。缺点是不能查看源代码，适合生产环境。</li> </ul> <p>多数情况下，在开发中主要使用 <code class="language-plaintext highlighter-rouge">cheap-module-source-map</code>；而在生产环境中，主要使用 <code class="language-plaintext highlighter-rouge">source-map</code>。</p> <h3 id="28-devserver">2.8 DevServer</h3> <p><code class="language-plaintext highlighter-rouge">devServer</code> 用于配置开发服务器。即设置开发环境中的本地服务器，以便进行实时预览、热模块替换（HMR）、代理请求等操作。<code class="language-plaintext highlighter-rouge">devServer</code> 常见的配置项如下。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">contentBase</code></strong>：指定开发服务器的根目录，即服务器将从哪个目录提供文件。</li> <li> <strong><code class="language-plaintext highlighter-rouge">https</code></strong>：是否启用 HTTPS 协议。</li> <li> <strong><code class="language-plaintext highlighter-rouge">host</code></strong>：指定开发服务器的主机名。</li> <li> <strong><code class="language-plaintext highlighter-rouge">port</code></strong>：指定开发服务器的端口号。</li> <li> <strong><code class="language-plaintext highlighter-rouge">open</code></strong>：是否自动打开浏览器。</li> <li> <strong><code class="language-plaintext highlighter-rouge">hot</code></strong>：是否启用模块热替换（HMR）。</li> <li> <strong><code class="language-plaintext highlighter-rouge">proxy</code></strong>：配置代理，将特定请求转发到其他服务器。</li> <li> <strong><code class="language-plaintext highlighter-rouge">compress</code></strong>：是否启用 gzip 压缩。</li> <li> <strong><code class="language-plaintext highlighter-rouge">before</code></strong> 和 <strong><code class="language-plaintext highlighter-rouge">after</code></strong>：在开发服务器启动之前或之后执行特定的中间件函数。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">contentBase</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// 指定根目录</span>
    <span class="na">https</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// 使用 HTTP 协议</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0.0.0.0</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 指定主机名</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span> <span class="c1">// 指定端口号</span>
    <span class="na">open</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 自动打开浏览器</span>
    <span class="na">hot</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用模块热替换</span>
    <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">compress</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用 gzip 压缩</span>
    <span class="na">before</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/some/path</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">custom</span><span class="p">:</span> <span class="dl">'</span><span class="s1">response</span><span class="dl">'</span> <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="na">after</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">server</span><span class="p">,</span> <span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Dev server is running!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// 其他配置项...</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="29-optimization">2.9 Optimization</h3> <p><code class="language-plaintext highlighter-rouge">optimization</code> 控制构建过程中的优化行为。以下是常见的 <code class="language-plaintext highlighter-rouge">optimization</code> 配置项。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">splitChunks</code></strong>：用于将代码拆分成更小的块，以实现代码的按需加载和更好的缓存策略。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minimize</code></strong>：是否启用代码压缩。一般在生产环境中使用。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minimizer</code></strong>：自定义代码压缩工具和压缩选项。默认使用 TerserPlugin 进行 JavaScript 代码压缩。</li> <li> <strong><code class="language-plaintext highlighter-rouge">providedExports</code></strong>：用于告诉 webpack 是否分析每个模块提供的导出内容。默认值为 true。</li> <li> <strong><code class="language-plaintext highlighter-rouge">usedExports</code></strong>：用于启用 Tree Shaking，去除未使用的导出。默认值为 true。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">TerserPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">terser-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">splitChunks</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">chunks</span><span class="p">:</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 对所有类型的代码进行分离</span>
    <span class="p">},</span>
    <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用代码压缩</span>
    <span class="na">minimizer</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nc">TerserPlugin</span><span class="p">({</span>
      <span class="na">terserOptions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">compress</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">drop_console</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 移除 console 语句</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">})],</span>
    <span class="na">runtimeChunk</span><span class="p">:</span> <span class="dl">'</span><span class="s1">single</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 提取运行时代码到单独的 chunk</span>
    <span class="na">moduleIds</span><span class="p">:</span> <span class="dl">'</span><span class="s1">deterministic</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 使用确定性的模块 ID</span>
    <span class="na">chunkIds</span><span class="p">:</span> <span class="dl">'</span><span class="s1">deterministic</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 使用确定性的 chunk ID</span>
    <span class="na">mangleWasmImports</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 压缩 WebAssembly 导入名称</span>
    <span class="na">removeAvailableModules</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 移除可用的模块</span>
    <span class="na">removeEmptyChunks</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 移除空的 chunk</span>
    <span class="na">mergeDuplicateChunks</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 合并重复的 chunk</span>
    <span class="na">flagIncludedChunks</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 标记包含的 chunk</span>
    <span class="na">providedExports</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">usedExports</span><span class="p">:</span> <span class="kc">true</span>
    <span class="na">sideEffects</span><span class="p">:</span> <span class="kc">true</span>
    <span class="na">nodeEnv</span><span class="p">:</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span>
    <span class="na">realContentHash</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h2 id="三webpack-的发布-订阅模式">三、webpack 的发布-订阅模式</h2> <h3 id="31-什么是发布-订阅模式">3.1 什么是发布-订阅模式？</h3> <p><strong>发布-订阅模式</strong> 是一种设计模式，其中一个主体（发布者）维护一系列依赖其状态的观察者（订阅者）。发布者在状态变化时向观察者发送通知，而观察者可以选择性地对这些通知做出响应。</p> <p>webpack 的插件系统基于发布-订阅模式。这个模式允许 webpack 在构建过程的不同阶段广播事件，插件可以订阅这些事件并在适当的时机执行特定的任务。</p> <p>在 webpack 中，发布者是 webpack 本身，它在构建过程的不同阶段广播事件。订阅者是 webpack 插件，它们订阅感兴趣的事件并在这些事件触发时执行特定逻辑。</p> <h3 id="32-webpack-生命周期广播事件">3.2 webpack 生命周期广播事件</h3> <p>webpack 在其构建生命周期的不同阶段会广播一系列事件。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">initialize</code></strong>：初始化阶段，webpack 构建过程开始。</li> <li> <strong><code class="language-plaintext highlighter-rouge">environment</code></strong>：设置环境变量。</li> <li> <strong><code class="language-plaintext highlighter-rouge">afterEnvironment</code></strong>：环境变量设置完成。</li> <li> <strong><code class="language-plaintext highlighter-rouge">entryOption</code></strong>：处理入口选项。</li> <li> <strong><code class="language-plaintext highlighter-rouge">afterPlugins</code></strong>：插件初始化完成。</li> <li> <strong><code class="language-plaintext highlighter-rouge">afterResolvers</code></strong>：解析器初始化完成。</li> <li> <strong><code class="language-plaintext highlighter-rouge">beforeRun</code></strong>：构建过程开始前。</li> <li> <strong><code class="language-plaintext highlighter-rouge">run</code></strong>：构建过程开始。</li> <li> <strong><code class="language-plaintext highlighter-rouge">beforeCompile</code></strong>：编译前准备阶段。</li> <li> <strong><code class="language-plaintext highlighter-rouge">compile</code></strong>：编译阶段开始。</li> <li> <strong><code class="language-plaintext highlighter-rouge">thisCompilation</code></strong>：新的 Compilation 创建前。</li> <li> <strong><code class="language-plaintext highlighter-rouge">compilation</code></strong>：新的 Compilation 创建后。</li> <li> <strong><code class="language-plaintext highlighter-rouge">make</code></strong>：从入口点开始构建模块。</li> <li> <strong><code class="language-plaintext highlighter-rouge">afterCompile</code></strong>：编译完成。</li> <li> <strong><code class="language-plaintext highlighter-rouge">emit</code></strong>：生成资源到输出目录前。</li> <li> <strong><code class="language-plaintext highlighter-rouge">afterEmit</code></strong>：生成资源到输出目录后。</li> <li> <strong><code class="language-plaintext highlighter-rouge">done</code></strong>：构建过程完成。</li> </ul> <h3 id="33-插件如何与广播事件协调工作">3.3 插件如何与广播事件协调工作</h3> <p>webpack 插件通过订阅这些事件来协调工作。插件在注册时将其逻辑挂载到特定的事件上，当事件被触发时，插件的逻辑会自动执行。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyPlugin</span> <span class="p">{</span>
  <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nf">tapAsync</span><span class="p">(</span><span class="dl">'</span><span class="s1">MyPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 插件的逻辑</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is my plugin!</span><span class="dl">'</span><span class="p">);</span>
      <span class="nf">callback</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyPlugin</span><span class="p">;</span>
</code></pre></div></div> <p>上面代码是一个自定义的插件，其中：</p> <ul> <li> <code class="language-plaintext highlighter-rouge">apply</code> 方法用于注册插件。</li> <li> <code class="language-plaintext highlighter-rouge">compiler</code> 对象是 webpack 编译器实例，提供了绑定事件的钩子（hooks）。</li> <li> <code class="language-plaintext highlighter-rouge">compiler.hooks.emit</code> 表示 <code class="language-plaintext highlighter-rouge">emit</code> 事件的钩子。<code class="language-plaintext highlighter-rouge">tapAsync</code> 方法用于异步钩子，注册一个回调函数，该函数将在 <code class="language-plaintext highlighter-rouge">emit</code> 事件被触发时执行。</li> </ul> <h3 id="34-webpack-插件与生命周期事件的工作流程">3.4 webpack 插件与生命周期事件的工作流程</h3> <ol> <li>插件注册：插件通过 <code class="language-plaintext highlighter-rouge">apply</code> 方法注册到 webpack 编译器。在 <code class="language-plaintext highlighter-rouge">apply</code> 方法中，插件通过 <code class="language-plaintext highlighter-rouge">compiler</code> 对象的钩子（hooks）订阅感兴趣的事件。</li> <li>事件触发：webpack 在构建过程的不同阶段触发事件。当事件被触发时，所有订阅了该事件的插件都将依次执行其注册的回调函数。</li> <li>回调执行：插件的回调函数执行其特定的逻辑。例如，修改编译资源、生成额外的文件、优化输出等。</li> </ol> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">class</span> <span class="nc">MyPlugin</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nf">tapAsync</span><span class="p">(</span><span class="dl">'</span><span class="s1">MyPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 生成一个额外的文件</span>
      <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">This is a generated file</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">outputPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">compiler</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="dl">'</span><span class="s1">generated-file.txt</span><span class="dl">'</span><span class="p">);</span>

      <span class="nx">compilation</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="dl">'</span><span class="s1">generated-file.txt</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">source</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">content</span><span class="p">,</span>
        <span class="na">size</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">content</span><span class="p">.</span><span class="nx">length</span>
      <span class="p">};</span>

      <span class="c1">// 写入文件到输出目录</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nf">writeFile</span><span class="p">(</span><span class="nx">outputPath</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">The file has been saved!</span><span class="dl">'</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyPlugin</span><span class="p">;</span>
</code></pre></div></div> <p>上面的代码，是一个自定义的插件，它会在 <code class="language-plaintext highlighter-rouge">emit</code> 阶段生成一个额外的文件。</p> <ul> <li>插件在 <code class="language-plaintext highlighter-rouge">emit</code> 阶段生成一个名为 <code class="language-plaintext highlighter-rouge">generated-file.txt</code> 的文件，并将其内容设置为 <code class="language-plaintext highlighter-rouge">"This is a generated file"</code>。</li> <li>通过 <code class="language-plaintext highlighter-rouge">compilation.assets</code> 将生成的文件添加到 webpack 的资源管理中。</li> <li>异步写入文件到输出目录，当写入完成后调用 <code class="language-plaintext highlighter-rouge">callback</code> 以通知 webpack 继续构建过程。</li> </ul> <h2 id="四webpack-的构建流程">四、webpack 的构建流程</h2> <p>webpack 的构建流程，主要包括初始化、编译、打包、优化和生成输出五个阶段。</p> <h3 id="41-初始化阶段">4.1 初始化阶段</h3> <p>在初始化阶段，webpack 根据配置文件和命令行参数进行初始化工作。包括以下步骤。</p> <ul> <li> <strong>读取配置</strong>：读取 webpack 配置文件（<code class="language-plaintext highlighter-rouge">webpack.config.js</code>）并解析配置项。</li> <li> <strong>注册插件</strong>：根据配置文件中的 <code class="language-plaintext highlighter-rouge">plugins</code> 项注册所有插件。</li> <li> <strong>创建编译器对象</strong>：初始化 <code class="language-plaintext highlighter-rouge">Compiler</code> 对象，这是 webpack 构建的核心引擎，负责整个构建过程的协调工作。</li> <li> <strong>应用插件</strong>：调用每个插件的 <code class="language-plaintext highlighter-rouge">apply</code> 方法，将插件挂载到 webpack 的钩子上。</li> <li> <strong>触发环境钩子</strong>：触发 <code class="language-plaintext highlighter-rouge">environment</code> 和 <code class="language-plaintext highlighter-rouge">afterEnvironment</code> 等初始化阶段的钩子。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./webpack.config.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nf">webpack</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="nx">compiler</span><span class="p">.</span><span class="nf">run</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nf">toString</span><span class="p">());</span>
<span class="p">});</span>
</code></pre></div></div> <p>初始化阶段的主要钩子如下。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">initialize</code>：初始化 webpack。</li> <li> <code class="language-plaintext highlighter-rouge">environment</code>：设置环境变量。</li> <li> <code class="language-plaintext highlighter-rouge">afterEnvironment</code>：环境变量设置完成。</li> <li> <code class="language-plaintext highlighter-rouge">entryOption</code>：处理入口选项。</li> </ul> <h3 id="42-编译阶段">4.2 编译阶段</h3> <p>编译阶段主要负责将源代码转换为 webpack 的模块化表示形式。</p> <ul> <li> <strong>确定入口点</strong>：根据配置中的 <code class="language-plaintext highlighter-rouge">entry</code> 项确定入口模块。</li> <li> <strong>递归解析模块</strong>：从入口点出发，递归解析依赖的模块。每个模块都会经过相应的 Loader 处理，转换为 webpack 能够理解的模块。</li> <li> <strong>生成模块依赖图</strong>：构建模块与模块之间的依赖关系图。</li> </ul> <p>以下是编译阶段的详细流程。</p> <ol> <li> <strong>创建 Compilation 对象</strong>：<code class="language-plaintext highlighter-rouge">Compiler</code> 对象会创建一个新的 <code class="language-plaintext highlighter-rouge">Compilation</code> 对象，用来存储当前编译的状态和结果。</li> <li> <strong>触发 Compilation 钩子</strong>：触发 <code class="language-plaintext highlighter-rouge">thisCompilation</code> 和 <code class="language-plaintext highlighter-rouge">compilation</code> 钩子，通知插件开始编译。</li> <li> <strong>构建模块</strong>： <ul> <li> <strong>从入口开始</strong>：从入口模块开始，使用 <code class="language-plaintext highlighter-rouge">loader</code> 对模块进行转换。</li> <li> <strong>递归解析</strong>：解析模块的依赖（如 <code class="language-plaintext highlighter-rouge">import</code> 或 <code class="language-plaintext highlighter-rouge">require</code> 语句）并递归处理依赖的模块。</li> <li> <strong>生成抽象语法树（AST）</strong>：解析模块代码并生成 AST。</li> <li> <strong>应用 Loader</strong>：按照配置的 <code class="language-plaintext highlighter-rouge">loader</code> 对模块进行处理。</li> <li> <strong>添加模块到依赖图</strong>：将处理后的模块添加到依赖图中。</li> </ul> </li> </ol> <p>编译阶段的主要钩子如下。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">beforeCompile</code>：编译开始前。</li> <li> <code class="language-plaintext highlighter-rouge">compile</code>：编译阶段开始。</li> <li> <code class="language-plaintext highlighter-rouge">thisCompilation</code>：新的 Compilation 创建前。</li> <li> <code class="language-plaintext highlighter-rouge">compilation</code>：新的 Compilation 创建后。</li> </ul> <h3 id="43-打包阶段">4.3 打包阶段</h3> <p>打包阶段负责将编译后的模块根据依赖图进行打包，生成一个或多个 Chunk。</p> <ul> <li> <strong>生成 Chunk</strong>：根据入口和依赖关系生成 Chunk，每个 Chunk 代表一个输出文件。</li> <li> <strong>添加 Chunk 到 Compilation</strong>：将生成的 Chunk 添加到 <code class="language-plaintext highlighter-rouge">Compilation</code> 对象中。</li> </ul> <p>打包阶段的主要钩子如下。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">make</code>：从入口点开始构建模块。</li> <li> <code class="language-plaintext highlighter-rouge">afterCompile</code>：编译完成。</li> </ul> <h3 id="44-优化阶段">4.4 优化阶段</h3> <p>在优化阶段，webpack 会对生成的 Chunk 进行优化，如代码压缩、提取公共模块等。</p> <ul> <li> <strong>代码拆分</strong>：提取公共模块、动态导入模块等。</li> <li> <strong>压缩代码</strong>：根据配置对代码进行压缩和混淆。</li> <li> <strong>其他优化</strong>：如 Tree Shaking、Scope Hoisting 等。</li> </ul> <h3 id="45-生成输出阶段">4.5 生成输出阶段</h3> <p>生成输出阶段负责将优化后的代码输出到指定的目录。</p> <ul> <li> <strong>生成输出资源</strong>：根据 Chunk 生成最终的输出文件（如 JavaScript、CSS、HTML 等）。</li> <li> <strong>写入文件系统</strong>：将生成的文件写入到输出目录（通常是 <code class="language-plaintext highlighter-rouge">dist</code> 目录）。</li> </ul> <p>以下是生成输出阶段的详细流程。</p> <ol> <li> <strong>触发 <code class="language-plaintext highlighter-rouge">emit</code> 钩子</strong>：在写入文件前触发 <code class="language-plaintext highlighter-rouge">emit</code> 钩子，通知插件进行最后的修改或添加额外的文件。</li> <li> <strong>写入文件到输出目录</strong>：将生成的文件写入到输出目录。</li> <li> <strong>触发 <code class="language-plaintext highlighter-rouge">afterEmit</code> 钩子</strong>：写入文件后触发 <code class="language-plaintext highlighter-rouge">afterEmit</code> 钩子，通知插件输出过程已完成。</li> </ol> <p>生成输出阶段的主要钩子如下。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">emit</code>：生成资源到输出目录前。</li> <li> <code class="language-plaintext highlighter-rouge">afterEmit</code>：生成资源到输出目录后。</li> </ul> <h2 id="loader">Loader</h2> <p>loader 本质上是导出为函数的 JavaScript 模块。<a href="https://github.com/webpack/loader-runner" rel="external nofollow noopener" target="_blank">loader runner</a> 会调用此函数，然后将上一个 loader 产生的结果或者资源文件传入进去。函数中的 <code class="language-plaintext highlighter-rouge">this</code> 作为上下文会被 webpack 填充，并且 loader runner 中包含一些实用的方法，比如可以使 loader 调用方式变为异步，或者获取 <code class="language-plaintext highlighter-rouge">query</code> 参数。</p> <p>如果是单个处理结果，可以在 <a href="#1%E5%90%8C%E6%AD%A5-loader">同步模式</a> 中直接返回。如果有多个处理结果，则必须调用 <code class="language-plaintext highlighter-rouge">this.callback()</code>。在 <a href="#2%E5%BC%82%E6%AD%A5-loader">异步模式</a> 中，必须调用 <code class="language-plaintext highlighter-rouge">this.async()</code> 来告知 loader runner 等待异步结果，它会返回 <code class="language-plaintext highlighter-rouge">this.callback()</code> 回调函数。随后 loader 必须返回 <code class="language-plaintext highlighter-rouge">undefined</code> 并且调用该回调函数。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 *
 * @param {string|Buffer} content 源文件的内容
 * @param {object} [map] 可以被 https://github.com/mozilla/source-map 使用的 SourceMap 数据
 * @param {any} [meta] meta 数据，可以是任何内容
 */</span>
<span class="kd">function</span> <span class="nf">webpackLoader</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>loader 分为几种不同的类型，他们是同步 Loader、异步 Loader、Raw Loader 和 Pitching Loader。</p> <h3 id="loader-分类">Loader 分类</h3> <h4 id="1同步-loader">（1）同步 Loader</h4> <p>通过 <code class="language-plaintext highlighter-rouge">return</code> 或者 <code class="language-plaintext highlighter-rouge">this.callback()</code> 同步地返回处理后的 <code class="language-plaintext highlighter-rouge">content</code> 值。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div> <p>上面的代码，使用 <code class="language-plaintext highlighter-rouge">return</code> 返回处理之后的 <code class="language-plaintext highlighter-rouge">content</code>，然后交由 webpack 或者之后的 <code class="language-plaintext highlighter-rouge">loader</code> 继续处理。</p> <p>除了使用 <code class="language-plaintext highlighter-rouge">return</code> 关键词，还可以使用 <code class="language-plaintext highlighter-rouge">this.callback()</code>，后者的优点是更灵活，因为它允许传递多个参数，而不仅仅是 <code class="language-plaintext highlighter-rouge">content</code>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">),</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>

  <span class="c1">// 当调用 callback() 函数时，总是返回 undefined</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="2异步-loader">（2）异步 Loader</h4> <p>异步 loader 使用 <code class="language-plaintext highlighter-rouge">this.async()</code> 来获取 callback 函数。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="k">async</span><span class="p">();</span>
  <span class="nf">someAsyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="3raw-loader">（3）Raw Loader</h4> <p>默认情况下，资源文件会被转化为 UTF-8 字符串，然后传给 loader。通过设置 <code class="language-plaintext highlighter-rouge">raw</code> 为 <code class="language-plaintext highlighter-rouge">true</code>，loader 可以接收原始的 Buffer。每个 loader 都可以用 String 或者 Buffer 的形式传递它的处理结果。complier 会把它们在 loader 之间相互转换。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">assert</span><span class="p">(</span><span class="nx">content</span> <span class="k">instanceof</span> <span class="nx">Buffer</span><span class="p">);</span>

  <span class="c1">// 返回值也可以是一个 `Buffer`</span>
  <span class="c1">// 即使不是 "raw"，loader 也没问题</span>
  <span class="k">return</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">raw</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</code></pre></div></div> <h4 id="4pitching-loader">（4）Pitching Loader</h4> <p>loader <strong>总是</strong>从右到左被调用。有些情况下，loader 只关心 request 后面的<strong>元数据</strong>（metadata），并且忽略前一个 loader 的结果。在实际（从右到左）执行 loader 之前，会先<strong>从左到右</strong>调用 loader 上的 <code class="language-plaintext highlighter-rouge">pitch()</code> 方法。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">pitch</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">remainingRequest</span><span class="p">,</span> <span class="nx">precedingRequest</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></div> <p>假如我们有以下配置。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="c1">//...</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">a-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">b-loader</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">c-loader</span><span class="dl">'</span><span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <p>上面的代码，会按照下面的顺序执行。</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|- a-loader `pitch`
  |- b-loader `pitch`
    |- c-loader `pitch`
      |- requested module is picked up as a dependency
    |- c-loader normal execution
  |- b-loader normal execution
|- a-loader normal execution
</code></pre></div></div> <p>从上面代码可以看出，在同一组 loader 配置中，<code class="language-plaintext highlighter-rouge">pitch()</code> 方法会优先执行。loader 模块中引入 “pitching” 阶段，主要是基于以下两个原因。</p> <ol> <li> <p>传递给 <code class="language-plaintext highlighter-rouge">pitch()</code> 方法的 <code class="language-plaintext highlighter-rouge">data</code>，在执行阶段也会暴露在 <code class="language-plaintext highlighter-rouge">this.data</code> 之下，并且可以用于在循环时，捕获并共享前面的信息。</p> <div class="language-javascript highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
 <span class="p">};</span>

 <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">pitch</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">remainingRequest</span><span class="p">,</span> <span class="nx">precedingRequest</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">data</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
 <span class="p">};</span>
</code></pre></div> </div> </li> <li> <p>如果某个 loader 在 <code class="language-plaintext highlighter-rouge">pitch()</code> 方法中给出一个结果，那么这个过程会回过身来，并跳过剩下的 loader。在我们上面的例子中，如果 <code class="language-plaintext highlighter-rouge">b-loader</code> 的 <code class="language-plaintext highlighter-rouge">pitch()</code> 方法返回了一些东西，<code class="language-plaintext highlighter-rouge">b-loader</code> 之后的 <code class="language-plaintext highlighter-rouge">pitch()</code> 方法以及所有的 loader 方法，都将不再执行。</p> <div class="language-javascript highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">someSyncOperation</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
 <span class="p">};</span>

 <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">pitch</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">remainingRequest</span><span class="p">,</span> <span class="nx">precedingRequest</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if </span><span class="p">(</span><span class="nf">someCondition</span><span class="p">())</span> <span class="p">{</span>
     <span class="k">return </span><span class="p">(</span>
       <span class="dl">'</span><span class="s1">module.exports = require(</span><span class="dl">'</span> <span class="o">+</span>
       <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="dl">'</span><span class="s1">-!</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">remainingRequest</span><span class="p">)</span> <span class="o">+</span>
       <span class="dl">'</span><span class="s1">);</span><span class="dl">'</span>
     <span class="p">);</span>
   <span class="p">}</span>
 <span class="p">};</span>
</code></pre></div> </div> <p>上面的代码，将会按照下面的顺序执行。</p> <div class="language-text highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> |- a-loader `pitch`
   |- b-loader `pitch` returns a module
 |- a-loader normal execution
</code></pre></div> </div> </li> </ol> <h3 id="loader-context">Loader Context</h3> <p>loader context 表示在 loader 内使用 <code class="language-plaintext highlighter-rouge">this</code> 可以访问的一些方法或属性。</p> <h4 id="thisasync">this.async()</h4> <p>用于告诉 loader-runner 这个 loader 将会异步地回调。返回 <code class="language-plaintext highlighter-rouge">this.callback()</code>。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="k">async</span><span class="p">();</span>
</code></pre></div></div> <h4 id="thiscallback">this.callback()</h4> <p>用于同步或异步调用，并返回多个结果。预期的参数是：</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nf">callback</span><span class="p">(</span>
  <span class="nx">err</span><span class="p">:</span> <span class="nb">Error</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">content</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">Buffer</span><span class="p">,</span>
  <span class="nx">sourceMap</span><span class="p">?:</span> <span class="nx">SourceMap</span><span class="p">,</span> <span class="c1">// 表示一个可以被 this module 解析的 source map</span>
  <span class="nx">meta</span><span class="p">?:</span> <span class="nx">any</span> <span class="c1">// 此参数会被 webpack 忽略，可以是任何东西（例如一些元数据）</span>
<span class="p">);</span>
</code></pre></div></div> <p>注意，在使用了 <code class="language-plaintext highlighter-rouge">this.callback()</code> 的情况下，就不应该在使用 <code class="language-plaintext highlighter-rouge">return</code> 返回 <code class="language-plaintext highlighter-rouge">content</code>，而是应该返回 <code class="language-plaintext highlighter-rouge">undefined</code>，从而避免含糊的 loader 结果。</p> <h4 id="thisemitfile">this.emitFile()</h4> <p>用于产生一个文件。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">emitFile</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">content</span><span class="p">:</span> <span class="nx">Buffer</span><span class="o">|</span><span class="nx">string</span><span class="p">,</span> <span class="nx">sourceMap</span><span class="p">:</span> <span class="p">{...})</span>
</code></pre></div></div> <h4 id="thisgetoptionsschema">this.getOptions(schema)</h4> <p>用于提取给定的 loader 选项，接受一个可选的 JSON schema 作为参数。</p> <h4 id="thisutils">this.utils</h4> <p>用于访问 <code class="language-plaintext highlighter-rouge">contextify</code> 与 <code class="language-plaintext highlighter-rouge">absolutify</code> 功能。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">contextify</code>：返回一个新的请求字符串，尽可能避免使用绝对路径。</li> <li> <code class="language-plaintext highlighter-rouge">absolutify</code>：尽可能使用相对路径返回一个新的请求字符串。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nf">contextify</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nf">absolutify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="dl">'</span><span class="s1">./index.js</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nf">absolutify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">resourcePath</span><span class="p">);</span>
  <span class="c1">// …</span>
  <span class="k">return</span> <span class="nx">content</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div> <p>这里只是列举出了几个常用的 Loader Context API，更多方法请参考 <a href="https://webpack.docschina.org/api/loaders/" rel="external nofollow noopener" target="_blank">Loader Interface</a>。</p> <h3 id="编写-loader">编写 Loader</h3> <h4 id="用法准则">用法准则</h4> <p>编写 loader 时应该遵循以下准则。它们按重要程度排序，有些仅适用于某些场景。</p> <h5 id="1保持简单">（1）保持<strong>简单</strong> </h5> <p>loaders 应该只做单一任务。这不仅使每个 loader 易维护，也可以在更多场景链式调用。</p> <h5 id="2使用链式传递">（2）使用<strong>链式</strong>传递</h5> <p>利用 loader 可以链式调用的优势。写五个简单的 loader 实现五项任务，而不是一个 loader 实现五项任务。功能隔离不仅使 loader 更简单，可能还可以将它们用于你原先没有想到的功能。</p> <h5 id="3模块化的输出">（3）<strong>模块化</strong>的输出</h5> <p>保证输出模块化。loader 生成的模块与普通模块遵循相同的设计原则。</p> <h5 id="4确保无状态">（4）确保<strong>无状态</strong> </h5> <p>确保 loader 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</p> <h5 id="5使用-loader-utilities">（5）使用 <strong>loader utilities</strong> </h5> <p>充分利用 <code class="language-plaintext highlighter-rouge">loader-utils</code> 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 loader 的选项。<code class="language-plaintext highlighter-rouge">schema-utils</code> 包配合 <code class="language-plaintext highlighter-rouge">loader-utils</code>，用于保证 loader 选项，进行与 JSON Schema 结构一致的校验。</p> <h5 id="6记录-loader-的依赖">（6）记录 <strong>loader 的依赖</strong> </h5> <p>如果一个 loader 使用外部资源（例如，从文件系统读取），必须声明它。这些信息用于使缓存 loaders 无效，以及在观察模式(watch mode)下重编译。</p> <h5 id="7解析模块依赖关系">（7）解析<strong>模块依赖关系</strong> </h5> <p>根据模块类型，可能会有不同的模式指定依赖关系。例如在 CSS 中，使用 <code class="language-plaintext highlighter-rouge">@import</code> 和 <code class="language-plaintext highlighter-rouge">url(...)</code> 语句来声明依赖。这些依赖关系应该由模块系统解析。</p> <p>可以通过以下两种方式中的一种来实现：</p> <ul> <li>通过把它们转化成 <code class="language-plaintext highlighter-rouge">require</code> 语句。</li> <li>使用 <code class="language-plaintext highlighter-rouge">this.resolve</code> 函数解析路径。</li> </ul> <p><code class="language-plaintext highlighter-rouge">css-loader</code> 是第一种方式的一个例子。它将 <code class="language-plaintext highlighter-rouge">@import</code> 语句替换为 <code class="language-plaintext highlighter-rouge">require</code> 其他样式文件，将 <code class="language-plaintext highlighter-rouge">url(...)</code> 替换为 <code class="language-plaintext highlighter-rouge">require</code> 引用文件，从而实现将依赖关系转化为 <code class="language-plaintext highlighter-rouge">require</code> 声明。</p> <p>对于 <code class="language-plaintext highlighter-rouge">less-loader</code>，无法将每个 <code class="language-plaintext highlighter-rouge">@import</code> 转化为 <code class="language-plaintext highlighter-rouge">require</code>，因为所有 <code class="language-plaintext highlighter-rouge">.less</code> 的文件中的变量和混合跟踪必须一次编译。因此，<code class="language-plaintext highlighter-rouge">less-loader</code> 将 less 编译器进行了扩展，自定义路径解析逻辑。然后，利用第二种方式，通过 webpack 的 <code class="language-plaintext highlighter-rouge">this.resolve</code> 解析依赖。</p> <h5 id="8提取通用代码">（8）提取<strong>通用代码</strong> </h5> <p>避免在 loader 处理的每个模块中生成通用代码。相反，你应该在 loader 中创建一个运行时文件，并生成 <code class="language-plaintext highlighter-rouge">require</code> 语句以引用该共享模块：</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/loader-runtime.js</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">someOtherModule</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./some-other-module</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nf">runtime</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">someOtherModule</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// src/loader.js</span>
<span class="k">import</span> <span class="nx">runtime</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./loader-runtime.js</span><span class="dl">'</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nf">loader</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nf">runtime</span><span class="p">({</span>
    <span class="nx">source</span><span class="p">,</span>
    <span class="na">y</span><span class="p">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">(),</span>
  <span class="p">})}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h5 id="9避免绝对路径">（9）避免<strong>绝对路径</strong> </h5> <p>不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化。<code class="language-plaintext highlighter-rouge">loader-utils</code> 中的 <a href="https://github.com/webpack/loader-utils#stringifyrequest" rel="external nofollow noopener" target="_blank">stringifyRequest</a> 方法，可以将绝对路径转化为相对路径。</p> <h5 id="10使用-peer-dependencies">（10）使用 <strong>peer dependencies</strong> </h5> <p>如果你的 loader 简单包裹另外一个包，你应该把这个包作为一个 peerDependency 引入。这种方式允许应用程序开发者在必要情况下，在 <code class="language-plaintext highlighter-rouge">package.json</code> 中指定所需的确定版本。</p> <p>例如，<code class="language-plaintext highlighter-rouge">sass-loader</code> 指定 <code class="language-plaintext highlighter-rouge">node-sass</code> 作为同等依赖，引用如下：</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"peerDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"node-sass"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.0.0"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="plugin">Plugin</h2> <p>webpack 在代码编译过程中，会触发一系列 Tapable 钩子事件，插件所做的，就是在相应的钩子上注册事件，执行不同的任务。当 webpack 构建的时候，插件注册的事件就会随着钩子的触发而执行。</p> <h3 id="钩子">钩子</h3> <p>钩子的本质是事件。webpack 把编译过程中触发的各类关键事件封装成事件接口暴露了出来。这些接口就被称为钩子（hooks），钩子是 webpack 插件中的关键概念。</p> <p><a href="https://github.com/webpack/tapable" rel="external nofollow noopener" target="_blank">Tapable</a> 为 webpack 提供了统一的插件接口（钩子）类型定义，它是 webpack 的核心功能库。webpack 中目前有十种 hooks。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// https://github.com/webpack/tapable/blob/master/lib/index.js</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">SyncHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./SyncHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">SyncBailHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./SyncBailHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">SyncWaterfallHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./SyncWaterfallHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">SyncLoopHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./SyncLoopHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncParallelHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncParallelHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncParallelBailHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncParallelBailHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncSeriesHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncSeriesHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncSeriesBailHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncSeriesBailHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncSeriesLoopHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncSeriesLoopHook</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">AsyncSeriesWaterfallHook</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./AsyncSeriesWaterfallHook</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div> <p>上面的钩子，按照执行方式，分为同步钩子和异步钩子，他们的名称分别以前缀 <code class="language-plaintext highlighter-rouge">Sync</code> 和 <code class="language-plaintext highlighter-rouge">Async</code> 开头。</p> <p>Tapable 还统一暴露了三个方法给插件，用于注入不同类型的自定义构建行为：</p> <ul> <li> <code class="language-plaintext highlighter-rouge">tap()</code>：可以注册同步钩子和异步钩子。</li> <li> <p><code class="language-plaintext highlighter-rouge">tapAsync()</code>：回调方式注册异步钩子。</p> <p>使用 <code class="language-plaintext highlighter-rouge">tapAsync()</code> 方法来绑定插件时，<strong>必须</strong>调用函数的最后一个参数 <code class="language-plaintext highlighter-rouge">callback()</code> 指定的回调函数。</p> <div class="language-javascript highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  <span class="kd">class</span> <span class="nc">HelloAsyncPlugin</span> <span class="p">{</span>
  <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nf">tapAsync</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">HelloAsyncPlugin</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// 执行某些异步操作...</span>
        <span class="nf">setTimeout</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">异步任务完成...</span><span class="dl">'</span><span class="p">);</span>
          <span class="nf">callback</span><span class="p">();</span>
        <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HelloAsyncPlugin</span><span class="p">;</span>
</code></pre></div> </div> </li> <li> <p><code class="language-plaintext highlighter-rouge">tapPromise()</code>：Promise 方式注册异步钩子。</p> <p>使用 <code class="language-plaintext highlighter-rouge">tapPromise()</code> 方法来绑定插件时，<strong>必须</strong>返回一个 Promise，异步任务完成后调用 Promise 的 <code class="language-plaintext highlighter-rouge">resolve()</code> 方法。</p> <div class="language-javascript highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  <span class="kd">class</span> <span class="nc">HelloAsyncPlugin</span> <span class="p">{</span>
    <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nf">tapPromise</span><span class="p">(</span><span class="dl">'</span><span class="s1">HelloAsyncPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// 返回一个 pormise ，异步任务完成后 resolve</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nf">setTimeout</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">异步任务完成...</span><span class="dl">'</span><span class="p">);</span>
            <span class="nf">resolve</span><span class="p">();</span>
          <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HelloAsyncPlugin</span><span class="p">;</span>
</code></pre></div> </div> </li> </ul> <h3 id="compiler">Compiler</h3> <p><code class="language-plaintext highlighter-rouge">compiler</code> 对象中保存着完整的 Webpack 环境配置，每次启动 webpack 构建时它都是一个独一无二，仅仅会创建一次的对象。这个对象会在首次启动 Webpack 时创建，我们可以通过 com`piler 对象上访问到 Webapck 的主环境配置，比如 loader、plugin 等等配置信息。它有以下主要属性。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">compiler.hooks</code>：用于注册 tapable 的不同种类 Hook，从而可以在 compiler 生命周期中植入不同的逻辑。</li> <li> <code class="language-plaintext highlighter-rouge">compiler.options</code>：用于访问本次启动 webpack 时候所有的配置文件，比如 <code class="language-plaintext highlighter-rouge">loaders</code>、<code class="language-plaintext highlighter-rouge">entry</code> 、<code class="language-plaintext highlighter-rouge">output</code>、<code class="language-plaintext highlighter-rouge">plugin</code> 等等完整配置信息。</li> <li> <code class="language-plaintext highlighter-rouge">compiler.inputFileSystem</code> 和 <code class="language-plaintext highlighter-rouge">compiler.outputFileSystem</code>：用于进行文件操作，相当于 Nodejs 中 <code class="language-plaintext highlighter-rouge">fs</code>。</li> </ul> <p>webpack 中的很多<a href="https://webpack.docschina.org/api/compiler-hooks/#hooks" rel="external nofollow noopener" target="_blank">生命周期函数钩子</a>，由 <code class="language-plaintext highlighter-rouge">compiler</code> 暴露，可以通过以下方式注册监听。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">someHook</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span><span class="dl">'</span><span class="s1">MyPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="compilation">Compilation</h3> <p><code class="language-plaintext highlighter-rouge">compilation</code> 对象代表一次资源的构建，<code class="language-plaintext highlighter-rouge">compilation</code> 实例能够访问所有的模块和它们的依赖。一个 <code class="language-plaintext highlighter-rouge">compilation</code> 对象会对构建依赖图中所有模块进行编译。在编译阶段，模块会被加载(load)、封存(seal)、优化(optimize)、分块(chunk)、哈希(hash)和重新创建(restore)。它有以下主要属性。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">compilation.modules</code>：用于访问所有模块，打包的每一个文件都是一个模块。</li> <li> <code class="language-plaintext highlighter-rouge">compilation.chunks</code>：chunk 即是多个 modules 组成而来的一个代码块。入口文件引入的资源组成一个 chunk，通过代码分割的模块又是另外的 chunk。</li> <li> <code class="language-plaintext highlighter-rouge">compilation.assets</code>：用于访问本次打包生成所有文件的结果。</li> <li> <code class="language-plaintext highlighter-rouge">compilation.hooks</code>：用于注册 tapable 的不同种类 Hook，用于在 <code class="language-plaintext highlighter-rouge">compilation</code> 编译模块阶段进行逻辑添加以及修改。</li> </ul> <p>Compilation 类扩展自 Tapable，并提供了很多<a href="https://webpack.docschina.org/api/compilation-hooks/" rel="external nofollow noopener" target="_blank">生命周期钩子</a>。他们的使用方式，跟使用 <code class="language-plaintext highlighter-rouge">compiler</code> 注册监听钩子的方式相同。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">compilation</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">someHook</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span><span class="dl">'</span><span class="s1">MyPlugin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="自定义-plugin">自定义 Plugin</h3> <p>webpack 插件由以下几个部分组成。</p> <ul> <li>一个 JavaScript 命名<strong>函数</strong>或<strong>类</strong>。</li> <li>在插件函数的 prototype 上定义一个 <code class="language-plaintext highlighter-rouge">apply</code> 方法。</li> <li>指定一个绑定到 webpack 自身的事件钩子。</li> <li>处理 webpack 内部实例的特定数据。</li> <li>功能完成后调用 webpack 提供的回调。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyExampleWebpackPlugin</span> <span class="p">{</span>
  <span class="c1">// 在插件函数的 prototype 上定义一个 `apply` 方法，以 compiler 为参数。</span>
  <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 指定一个挂载到 webpack 自身的事件钩子。</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nf">tapAsync</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">MyExampleWebpackPlugin</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">这是一个示例插件！</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span>
          <span class="dl">'</span><span class="s1">这里表示了资源的单次构建的 `compilation` 对象：</span><span class="dl">'</span><span class="p">,</span>
          <span class="nx">compilation</span>
        <span class="p">);</span>

        <span class="c1">// 用 webpack 提供的插件 API 处理构建过程</span>
        <span class="nx">compilation</span><span class="p">.</span><span class="nf">addModule</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>

        <span class="nf">callback</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>插件是由「具有 <code class="language-plaintext highlighter-rouge">apply</code> 方法的 prototype 对象」所实例化出来的。这个 <code class="language-plaintext highlighter-rouge">apply</code> 方法在安装插件时，会被 <code class="language-plaintext highlighter-rouge">compiler</code> 调用一次。apply 方法可以接收一个 <code class="language-plaintext highlighter-rouge">compiler</code> 对象的引用，从而可以在回调函数中访问到 <code class="language-plaintext highlighter-rouge">compiler</code> 对象。一个插件结构如下。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">HelloWorldPlugin</span> <span class="p">{</span>
  <span class="nf">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nf">tap</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">Hello World Plugin</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">(</span>
        <span class="nx">stats</span> <span class="cm">/* 绑定 done 钩子后，stats 会作为参数传入。 */</span>
      <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World!</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HelloWorldPlugin</span><span class="p">;</span>
</code></pre></div></div> <p>然后就可以在 webpack 配置文件中使用。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">HelloWorldPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello-world</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nc">HelloWorldPlugin</span><span class="p">({</span> <span class="na">options</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})],</span>
<span class="p">};</span>
</code></pre></div></div> <h2 id="六webpack-优化前端性能">六、webpack 优化前端性能</h2> <h3 id="61-启用代码压缩">6.1 启用代码压缩</h3> <h4 id="1压缩-html-代码">（1）压缩 HTML 代码</h4> <p><code class="language-plaintext highlighter-rouge">html-webpack-plugin</code> 用于简化 HTML 文件的创建、管理以及注入打包后的 JavaScript 文件。下面列出了一些 <code class="language-plaintext highlighter-rouge">html-webpack-plugin</code> 常用的配置项。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">title</code></strong>：页面的标题，会被插入到 <code class="language-plaintext highlighter-rouge">&lt;title&gt;</code> 标签中。</li> <li> <strong><code class="language-plaintext highlighter-rouge">filename</code></strong>：生成的 HTML 文件的名称，默认是 <code class="language-plaintext highlighter-rouge">index.html</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">template</code></strong>：指定模板文件的路径。</li> <li> <strong><code class="language-plaintext highlighter-rouge">inject</code></strong>：注入选项，默认为 <code class="language-plaintext highlighter-rouge">true</code>，表示将打包的资源注入到生成的 HTML 文件中。它可以是 <code class="language-plaintext highlighter-rouge">true</code>、<code class="language-plaintext highlighter-rouge">false</code>、<code class="language-plaintext highlighter-rouge">'head'</code> 或者 <code class="language-plaintext highlighter-rouge">'body'</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">favicon</code></strong>：指定 favicon 文件的路径。</li> <li> <strong><code class="language-plaintext highlighter-rouge">meta</code></strong>：注入页面的 <code class="language-plaintext highlighter-rouge">meta</code> 标签，可以是一个对象。</li> <li> <strong><code class="language-plaintext highlighter-rouge">hash</code></strong>：如果为 <code class="language-plaintext highlighter-rouge">true</code>，则会在所有的资源文件后面加一个唯一的 hash，防止缓存。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minify</code></strong>：用于控制生成的 HTML 文件的代码压缩。这个属性接受一个对象，内含多个配置选项，分别控制不同的压缩行为。</li> </ul> <p>通过配置 <code class="language-plaintext highlighter-rouge">html-webpack-plugin</code> 的 <code class="language-plaintext highlighter-rouge">minify</code> 属性来压缩 HTML 代码。以下是 <code class="language-plaintext highlighter-rouge">minify</code> 属性的常用选项。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">collapseWhitespace</code></strong>：压缩 HTML 中的空白。</li> <li> <strong><code class="language-plaintext highlighter-rouge">removeComments</code></strong>：移除 HTML 中的注释。</li> <li> <strong><code class="language-plaintext highlighter-rouge">removeRedundantAttributes</code></strong>：移除多余的属性（如 <code class="language-plaintext highlighter-rouge">&lt;input type="text"&gt;</code> 中的 <code class="language-plaintext highlighter-rouge">type="text"</code>）。</li> <li> <strong><code class="language-plaintext highlighter-rouge">removeScriptTypeAttributes</code></strong>：移除 <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> 标签中的 <code class="language-plaintext highlighter-rouge">type="text/javascript"</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">removeStyleLinkTypeAttributes</code></strong>：移除 <code class="language-plaintext highlighter-rouge">&lt;link&gt;</code> 和 <code class="language-plaintext highlighter-rouge">&lt;style&gt;</code> 标签中的 <code class="language-plaintext highlighter-rouge">type="text/css"</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">useShortDoctype</code></strong>：将文档类型简化为 <code class="language-plaintext highlighter-rouge">&lt;!DOCTYPE html&gt;</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minifyCSS</code></strong>：压缩内联的 CSS。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minifyJS</code></strong>：压缩内联的 JavaScript。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nc">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./src/index.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">minify</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">collapseWhitespace</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">removeComments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">removeRedundantAttributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">removeScriptTypeAttributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">removeStyleLinkTypeAttributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">useShortDoctype</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">minifyCSS</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">minifyJS</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">]</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="2压缩-css-代码">（2）压缩 CSS 代码</h4> <p><code class="language-plaintext highlighter-rouge">css-minimizer-webpack-plugin</code> 是一个用于压缩 CSS 代码的 Webpack 插件，它基于 cssnano 提供的优化功能，能够有效地减少 CSS 文件的体积，从而提升加载性能。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">test</code></strong>：匹配需要压缩的文件，默认值是 <code class="language-plaintext highlighter-rouge">/\.css$/i</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">parallel</code></strong>：启用并行压缩以提升构建速度，默认为 <code class="language-plaintext highlighter-rouge">true</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minimizerOptions</code></strong>：传递给 cssnano 的配置选项。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">CssMinimizerPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">css-minimizer-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">minimizer</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">`...`</span><span class="p">,</span>
      <span class="k">new</span> <span class="nc">CssMinimizerPlugin</span><span class="p">({</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/i</span><span class="p">,</span>
        <span class="na">parallel</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">minimizerOptions</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">preset</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">'</span><span class="s1">default</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">{</span>
              <span class="na">discardComments</span><span class="p">:</span> <span class="p">{</span> <span class="na">removeAll</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="c1">// 移除所有注释</span>
            <span class="p">},</span>
          <span class="p">],</span>
        <span class="p">},</span>
      <span class="p">}),</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="3压缩-javascript-代码">（3）压缩 JavaScript 代码</h4> <p><code class="language-plaintext highlighter-rouge">terser-webpack-plugin</code> 用于压缩和优化 JavaScript 代码。它基于 Terser，一个 JavaScript 解析器、压缩器、美化器和 AST 工具包。<code class="language-plaintext highlighter-rouge">terser-webpack-plugin</code> 是 Webpack 内置的 JavaScript 压缩插件，在生产环境下默认使用，可以通过自定义配置优化其行为。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">test</code></strong>：匹配需要压缩的文件，默认值是 <code class="language-plaintext highlighter-rouge">/\.m?js(\?.*)?$/i</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">parallel</code></strong>：启用并行压缩以提升构建速度，默认为 <code class="language-plaintext highlighter-rouge">true</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">extractComments</code></strong>：提取注释到单独的文件中，默认为 <code class="language-plaintext highlighter-rouge">true</code>。</li> <li> <strong><code class="language-plaintext highlighter-rouge">terserOptions</code></strong>：传递给 Terser 的配置选项，详细配置见 Terser Options。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">TerserPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">terser-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">minimizer</span><span class="p">:</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nc">TerserPlugin</span><span class="p">({</span>
        <span class="na">parallel</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">extractComments</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">terserOptions</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">compress</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">drop_console</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="p">},</span>
          <span class="na">format</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">comments</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">},</span>
      <span class="p">}),</span>
    <span class="p">],</span>
  <span class="p">},</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="62-图片压缩">6.2 图片压缩</h3> <p><code class="language-plaintext highlighter-rouge">file-loader</code> 的主要作用是将文件导出到输出目录，并返回文件的 URL。它可以处理各种类型的文件，包括图片、字体、音频、视频等。以下是几个常用的 <code class="language-plaintext highlighter-rouge">file-loader</code> 配置项。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">name</code>：设置文件的命名格式，可以使用占位符（如 <code class="language-plaintext highlighter-rouge">[name]</code>、<code class="language-plaintext highlighter-rouge">[ext]</code>、<code class="language-plaintext highlighter-rouge">[hash]</code> 等）。</li> <li> <code class="language-plaintext highlighter-rouge">outputPath</code>：设置文件输出目录，可以是相对于输出路径的相对路径。</li> <li> <code class="language-plaintext highlighter-rouge">publicPath</code>：设置文件的公共路径（通常用于 CDN）。</li> <li> <code class="language-plaintext highlighter-rouge">emitFile</code>：是否输出文件，默认为 <code class="language-plaintext highlighter-rouge">true</code>。</li> </ul> <p><code class="language-plaintext highlighter-rouge">image-webpack-loader</code> 是一个图片压缩加载器，可以结合 <code class="language-plaintext highlighter-rouge">file-loader</code> 使用，处理后的图片会自动进行压缩优化，从而减少文件体积，提高加载性能。以下是几个常用的 <code class="language-plaintext highlighter-rouge">image-webpack-loader</code> 配置项。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">mozjpeg</code>：配置 <code class="language-plaintext highlighter-rouge">mozjpeg</code> 压缩工具的选项。 <ul> <li> <code class="language-plaintext highlighter-rouge">progressive</code>：是否开启渐进式 JPEG。</li> <li> <code class="language-plaintext highlighter-rouge">quality</code>：图像质量，范围是 0-100。</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">optipng</code>：配置 <code class="language-plaintext highlighter-rouge">optipng</code> 压缩工具的选项。 <ul> <li> <code class="language-plaintext highlighter-rouge">enabled</code>：是否开启 <code class="language-plaintext highlighter-rouge">optipng</code> 压缩。</li> <li> <code class="language-plaintext highlighter-rouge">optimizationLevel</code>：优化级别，范围是 0-7。</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">pngquant</code>：配置 <code class="language-plaintext highlighter-rouge">pngquant</code> 压缩工具的选项。 <ul> <li> <code class="language-plaintext highlighter-rouge">quality</code>：图像质量范围，如 [0.65, 0.90]。</li> <li> <code class="language-plaintext highlighter-rouge">speed</code>：压缩速度，范围是 1-11。</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">gifsicle</code>：配置 <code class="language-plaintext highlighter-rouge">gifsicle</code> 压缩工具的选项。 <ul> <li> <code class="language-plaintext highlighter-rouge">interlaced</code>：是否开启交错模式。</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">webp</code>：配置 <code class="language-plaintext highlighter-rouge">webp</code> 压缩工具的选项。 <ul> <li> <code class="language-plaintext highlighter-rouge">quality</code>：图像质量，范围是 0-100。</li> </ul> </li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpe</span><span class="se">?</span><span class="sr">g|gif|svg</span><span class="se">)</span><span class="sr">$/i</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">file-loader</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[name].[hash].[ext]</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">outputPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">images/</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">image-webpack-loader</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">mozjpeg</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">progressive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="na">quality</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
              <span class="p">},</span>
              <span class="na">optipng</span><span class="p">:</span> <span class="p">{</span> <span class="na">enabled</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
              <span class="na">pngquant</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">quality</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">],</span>
                <span class="na">speed</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
              <span class="p">},</span>
              <span class="na">gifsicle</span><span class="p">:</span> <span class="p">{</span> <span class="na">interlaced</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
              <span class="na">webp</span><span class="p">:</span> <span class="p">{</span> <span class="na">quality</span><span class="p">:</span> <span class="mi">75</span> <span class="p">},</span>
            <span class="p">},</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="63-tree-shaking">6.3 Tree Shaking</h3> <p>Tree Shaking 通过在编译时分析模块的依赖关系，移除那些没有被引用的代码，从而减少最终打包文件的体积。为了启用 Tree Shaking，需要使用 ES6 模块语法（import/export）并配置 optimization。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">usedExports</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 启用 Tree Shaking</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="64-代码分离code-splitting">6.4 代码分离（Code Splitting）</h3> <p>将代码分离到不同的 bundle 中，之后我们可以按需加载，或者并行加载这些文件。默认情况下，所有的 JavaScript 代码（业务代码、第三方依赖、暂时没有用到的模块）在首页全部都加载，就会影响首页的加载速度。代码分离可以分出出更小的 bundle，以及控制资源加载优先级，提供代码的加载性能。</p> <p>SplitChunksPlugin 是 Webpack 提供的一个内置插件，可以用于实现代码分离（code splitting）。SplitChunksPlugin 的常用配置如下。</p> <ul> <li> <strong><code class="language-plaintext highlighter-rouge">chunks</code></strong>：可以是 <code class="language-plaintext highlighter-rouge">'all'</code>、<code class="language-plaintext highlighter-rouge">'async'</code> 或 <code class="language-plaintext highlighter-rouge">'initial'</code>。指定要分离的块类型。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minSize</code></strong>：生成块的最小大小（以字节为单位），默认值为 30000。</li> <li> <strong><code class="language-plaintext highlighter-rouge">maxSize</code></strong>：生成块的最大大小（以字节为单位），超过此大小会进一步分离。</li> <li> <strong><code class="language-plaintext highlighter-rouge">minChunks</code></strong>：最少引用次数，文件被引用次数超过此值时才会被分离，默认值为 1。</li> <li> <strong><code class="language-plaintext highlighter-rouge">maxAsyncRequests</code></strong>：按需加载时的最大并行请求数，默认值为 6。</li> <li> <strong><code class="language-plaintext highlighter-rouge">maxInitialRequests</code></strong>：入口点的最大并行请求数，默认值为 4。</li> <li> <strong><code class="language-plaintext highlighter-rouge">automaticNameDelimiter</code></strong>：生成名称时的分隔符，默认值为 ~。</li> <li> <strong><code class="language-plaintext highlighter-rouge">name</code></strong>：指定分离块的名称，可以是 <code class="language-plaintext highlighter-rouge">true</code>、<code class="language-plaintext highlighter-rouge">false</code> 或者一个函数。</li> <li> <strong><code class="language-plaintext highlighter-rouge">cacheGroups</code></strong>：指定缓存组，为不同的分离规则定义不同的缓存组。</li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">optimization</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">splitChunks</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">chunks</span><span class="p">:</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">minSize</span><span class="p">:</span> <span class="mi">20000</span><span class="p">,</span>
      <span class="na">maxSize</span><span class="p">:</span> <span class="mi">70000</span><span class="p">,</span>
      <span class="na">minChunks</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">maxAsyncRequests</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="na">maxInitialRequests</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="na">automaticNameDelimiter</span><span class="p">:</span> <span class="dl">'</span><span class="s1">~</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">cacheGroups</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">vendors</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">[\\/]</span><span class="sr">node_modules</span><span class="se">[\\/]</span><span class="sr">/</span><span class="p">,</span>
          <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">vendors</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">chunks</span><span class="p">:</span> <span class="dl">'</span><span class="s1">all</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="na">default</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">minChunks</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="na">priority</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
          <span class="na">reuseExistingChunk</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></div> <p>上面代码中，我们定义了两个缓存组。<code class="language-plaintext highlighter-rouge">vendors</code> 缓存组用来将所有来自 <code class="language-plaintext highlighter-rouge">node_modules</code> 目录的模块分离到一个名为 <code class="language-plaintext highlighter-rouge">vendors</code> 的块中。<code class="language-plaintext highlighter-rouge">default</code> 缓存组用来将被至少两次引用的模块分离到一个默认块中，并且优先级较低。</p> <h2 id="七提高-webpack-的构建速度">七、提高 webpack 的构建速度</h2> <h2 id="八参考">八、参考</h2> <ul> <li>webpack 文档，<a href="https://webpack.docschina.org/" rel="external nofollow noopener" target="_blank">webpack</a> </li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/07-caching/">HTTP 缓存</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/04-connection-management/">HTTP 连接管理</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/style/">ES6 - 编程风格</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/application-layer/">计算机网络 - 应用层</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/responsive-web-design/">响应式 Web 设计</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zhang Feng. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-repositories",title:"repositories",description:"Edit the `_data/repositories.yml` and change the `github_users` and `github_repos` lists to include your own GitHub profile and repositories.",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-cv",title:"cv",description:"This is a description of the page. You can modify it in &#39;_pages/cv.md&#39;. You can also change or remove the top pdf download button.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"nav-people",title:"people",description:"members of the lab or group",section:"Navigation",handler:()=>{window.location.href="/people/"}},{id:"dropdown-blog",title:"blog",description:"",section:"Dropdown",handler:()=>{window.location.href="/blog/"}},{id:"post-webpack",title:"Webpack",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/webpack/"}},{id:"post-http-\u7f13\u5b58",title:"HTTP \u7f13\u5b58",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/07-caching/"}},{id:"post-http-\u8fde\u63a5\u7ba1\u7406",title:"HTTP \u8fde\u63a5\u7ba1\u7406",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/04-connection-management/"}},{id:"post-es6-\u7f16\u7a0b\u98ce\u683c",title:"ES6 - \u7f16\u7a0b\u98ce\u683c",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/style/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u5e94\u7528\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u5e94\u7528\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/application-layer/"}},{id:"post-\u54cd\u5e94\u5f0f-web-\u8bbe\u8ba1",title:"\u54cd\u5e94\u5f0f Web \u8bbe\u8ba1",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/responsive-web-design/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u8fd0\u8f93\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u8fd0\u8f93\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/transport-layer/"}},{id:"post-react-\u4e2d\u7684\u4e8b\u4ef6",title:"React \u4e2d\u7684\u4e8b\u4ef6",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/events-in-react/"}},{id:"post-css-\u9884\u5904\u7406\u5668",title:"CSS \u9884\u5904\u7406\u5668",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/css-preprocessor/"}},{id:"post-css-modules-\u7528\u6cd5\u6559\u7a0b",title:"CSS Modules \u7528\u6cd5\u6559\u7a0b",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/css-modules/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u7f51\u7edc\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u7f51\u7edc\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/network-layer/"}},{id:"post-\u8de8\u57df\u8d44\u6e90\u5171\u4eab-cors",title:"\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff08CORS\uff09",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/cors/"}},{id:"post-\u9632\u6296\u548c\u8282\u6d41",title:"\u9632\u6296\u548c\u8282\u6d41",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/debounce-and-throttle/"}},{id:"post-es6-symbol",title:"ES6 - Symbol",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/symbol/"}},{id:"post-es6-\u5b57\u7b26\u4e32\u7684\u6269\u5c55",title:"ES6 - \u5b57\u7b26\u4e32\u7684\u6269\u5c55",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/string/"}},{id:"post-es6-set",title:"ES6 - Set",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/set/"}},{id:"post-es6-reflect",title:"ES6 - Reflect",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/reflect/"}},{id:"post-es6-proxy",title:"ES6 - Proxy",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/proxy/"}},{id:"post-es6-promise-\u5bf9\u8c61",title:"ES6 - Promise \u5bf9\u8c61",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/promise/"}},{id:"post-es6-object",title:"ES6 - Object",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/object/"}},{id:"post-es6-\u6a21\u5757",title:"ES6 - \u6a21\u5757",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/module/"}},{id:"post-es6-map",title:"ES6 - Map",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/map/"}},{id:"post-es6-let-\u548c-const-\u547d\u4ee4",title:"ES6 - let \u548c const \u547d\u4ee4",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/let-const/"}},{id:"post-es6-iterator",title:"ES6 - Iterator",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/iterator/"}},{id:"post-es6-generator-\u51fd\u6570",title:"ES6 - Generator \u51fd\u6570",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/generator/"}},{id:"post-es6-function",title:"ES6 - Function",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/function/"}},{id:"post-es6-decorator",title:"ES6 - Decorator",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/decorator/"}},{id:"post-es6-class",title:"ES6 - Class",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/class/"}},{id:"post-es6-async-\u51fd\u6570",title:"ES6 - async \u51fd\u6570",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/async/"}},{id:"post-es6-array",title:"ES6 - Array",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/array/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u6570\u636e\u94fe\u8def\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u6570\u636e\u94fe\u8def\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/data-link-layer/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u7269\u7406\u5c42",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u7269\u7406\u5c42",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/physical-layer/"}},{id:"post-\u8ba1\u7b97\u673a\u7f51\u7edc-\u6982\u8ff0",title:"\u8ba1\u7b97\u673a\u7f51\u7edc - \u6982\u8ff0",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/instruction/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%7A%66%65%6E%67%30%37%31%32@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=qc6CJjYAAAAJ","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>